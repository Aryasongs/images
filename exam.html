<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Oriontec Education Board | Online Assessment Portal</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&family=Dancing+Script:wght@600&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .hidden { display: none !important; }
        .timer-red { color: #ef4444; animation: pulse 1s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        .option-btn:hover { border-color: #1e3a8a; background-color: #f0f9ff; }
        .selected-option { border-color: #1e3a8a !important; background-color: #eff6ff !important; }
    </style>
</head>
<body class="bg-slate-50 text-slate-900 min-h-screen">

    <!-- Header -->
    <nav class="bg-white border-b sticky top-0 z-50 px-6 py-4 shadow-sm">
        <div class="max-w-7xl mx-auto flex justify-between items-center">
            <div class="flex items-center space-x-3">
                <div class="w-10 h-10 bg-blue-900 rounded-lg flex items-center justify-center text-white font-bold text-xl shadow-lg">O</div>
                <div>
                    <h1 class="font-bold text-blue-900 leading-tight">Oriontec</h1>
                    <p class="text-[10px] uppercase tracking-widest text-slate-500 font-bold">Education Board</p>
                </div>
            </div>
            <div id="active-session" class="hidden flex items-center space-x-2 bg-blue-50 px-3 py-1 rounded-full border border-blue-100">
                <span class="w-2 h-2 bg-blue-600 rounded-full animate-pulse"></span>
                <span id="nav-user-name" class="text-xs font-bold text-blue-900">Active</span>
            </div>
            <button onclick="app.showPage('admin-login')" class="text-xs font-bold text-slate-400 hover:text-blue-900 uppercase">Admin Portal</button>
        </div>
    </nav>

    <main class="max-w-5xl mx-auto p-4 md:p-10">
        
        <!-- View: Registration -->
        <section id="view-registration" class="max-w-xl mx-auto">
            <div class="bg-white rounded-[2rem] shadow-2xl p-8 md:p-10 border border-slate-200">
                <div class="text-center mb-8">
                    <span class="bg-blue-100 text-blue-700 text-[10px] font-bold px-3 py-1 rounded-full uppercase">Official Certification</span>
                    <h2 class="text-3xl font-black mt-4 text-slate-800">Candidate Enrollment</h2>
                    <p class="text-slate-500 text-sm mt-2">Apni details bhariye aur test shuru kijiye.</p>
                </div>
                
                <form id="regForm" class="space-y-5" onsubmit="app.handleRegistration(event)">
                    <div class="space-y-1">
                        <label class="text-xs font-bold text-slate-500 uppercase ml-1">Full Name</label>
                        <input type="text" name="name" required class="w-full px-5 py-4 rounded-2xl bg-slate-50 border-2 border-slate-100 focus:border-blue-600 focus:bg-white outline-none transition shadow-sm" placeholder="e.g. Rahul Kumar">
                    </div>
                    
                    <div class="space-y-1">
                        <label class="text-xs font-bold text-slate-500 uppercase ml-1">Email Address</label>
                        <input type="email" name="email" required class="w-full px-5 py-4 rounded-2xl bg-slate-50 border-2 border-slate-100 focus:border-blue-600 focus:bg-white outline-none transition shadow-sm" placeholder="rahul@example.com">
                    </div>

                    <div class="space-y-1">
                        <label class="text-xs font-bold text-slate-500 uppercase ml-1">Select Course</label>
                        <select name="course" required class="w-full px-5 py-4 rounded-2xl bg-slate-50 border-2 border-slate-100 focus:border-blue-600 focus:bg-white outline-none transition shadow-sm appearance-none">
                            <option value="">Course chuniye...</option>
                            <option value="IT Fundamentals">IT Fundamentals</option>
                            <option value="Digital Literacy">Digital Literacy & Office Suite</option>
                            <option value="Web Development">Full Stack Web Development</option>
                        </select>
                    </div>

                    <div class="p-4 bg-amber-50 rounded-2xl border border-amber-100 flex items-start space-x-3">
                        <div class="text-amber-600 mt-1">‚ö†Ô∏è</div>
                        <p class="text-[11px] text-amber-800 font-medium leading-relaxed">
                            <b>Proctoring Alert:</b> Test ke beech me tab switch karna ya window minimize karna mana hai. Aisa karne par test automatic submit ho sakta hai.
                        </p>
                    </div>

                    <button type="submit" class="w-full bg-blue-900 text-white py-5 rounded-2xl font-black uppercase tracking-widest hover:bg-blue-800 shadow-xl transition transform active:scale-[0.98]">
                        Begin Assessment Now
                    </button>
                </form>
            </div>
        </section>

        <!-- View: Examination -->
        <section id="view-exam" class="hidden space-y-6">
            <div class="flex flex-col lg:flex-row gap-8">
                <!-- Left: Question Area -->
                <div class="flex-1">
                    <div class="bg-white rounded-[2rem] shadow-xl p-8 border border-slate-200 min-h-[500px] flex flex-col">
                        <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-8 pb-6 border-b border-slate-100 gap-4">
                            <div>
                                <h3 id="exam-course-title" class="text-xl font-bold text-blue-900 uppercase tracking-tight">Course Name</h3>
                                <p id="exam-candidate-name" class="text-xs font-bold text-slate-400 uppercase mt-1"></p>
                            </div>
                            <div class="bg-slate-900 text-white px-6 py-3 rounded-2xl flex items-center space-x-4 shadow-lg">
                                <span class="text-[10px] font-bold text-slate-400 uppercase">Time Left</span>
                                <span id="timer" class="text-2xl font-mono font-bold">10:00</span>
                            </div>
                        </div>

                        <div id="question-container" class="flex-1">
                            <!-- Questions injection point -->
                        </div>

                        <div class="flex justify-between items-center mt-10 pt-6 border-t border-slate-100">
                            <button onclick="app.prevQuestion()" id="btn-prev" class="px-8 py-3 rounded-xl border-2 border-slate-100 font-bold text-slate-400 hover:bg-slate-50 transition disabled:opacity-30">Previous</button>
                            <button onclick="app.nextQuestion()" id="btn-next" class="px-10 py-3 rounded-xl bg-blue-900 text-white font-bold hover:bg-blue-800 shadow-lg transition">Next</button>
                        </div>
                    </div>
                </div>

                <!-- Right: Palette & Security -->
                <div class="w-full lg:w-72 space-y-6">
                    <div class="bg-white p-6 rounded-2xl border border-slate-200 shadow-sm">
                        <p class="text-[10px] font-black text-slate-400 uppercase mb-4 tracking-widest">Integrity Monitoring</p>
                        <div class="p-3 rounded-xl border flex justify-between items-center" id="security-indicator">
                            <span class="text-xs font-bold text-slate-600">Health:</span>
                            <span id="security-score" class="text-xs font-black text-green-600 uppercase">Stable</span>
                        </div>
                        <p class="text-[10px] text-slate-400 mt-4 leading-relaxed italic">System is monitoring window focus and tab switches.</p>
                    </div>

                    <div class="bg-white p-6 rounded-2xl border border-slate-200 shadow-sm">
                        <p class="text-[10px] font-black text-slate-400 uppercase mb-4 tracking-widest">Question Palette</p>
                        <div id="palette-container" class="grid grid-cols-5 gap-2">
                            <!-- Palette buttons -->
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- View: Result -->
        <section id="view-result" class="hidden max-w-2xl mx-auto">
            <div class="bg-white rounded-[2.5rem] shadow-2xl p-10 md:p-14 text-center border border-slate-200">
                <div id="res-icon" class="w-24 h-24 mx-auto rounded-full flex items-center justify-center text-4xl mb-8"></div>
                <h2 id="res-title" class="text-3xl font-black text-slate-800 mb-2">Assessment Completed</h2>
                <p id="res-msg" class="text-slate-500 mb-10 max-w-sm mx-auto text-sm"></p>

                <div class="grid grid-cols-2 gap-4 mb-10">
                    <div class="bg-slate-50 p-6 rounded-3xl border border-slate-100">
                        <p class="text-[10px] font-bold text-slate-400 uppercase mb-1 tracking-widest">Your Score</p>
                        <p id="res-score" class="text-3xl font-black text-blue-900">0%</p>
                    </div>
                    <div class="bg-slate-50 p-6 rounded-3xl border border-slate-100">
                        <p class="text-[10px] font-bold text-slate-400 uppercase mb-1 tracking-widest">Final Status</p>
                        <p id="res-status" class="text-2xl font-black">--</p>
                    </div>
                </div>

                <div id="pass-actions" class="hidden space-y-4">
                    <button onclick="app.downloadCertificate()" class="w-full bg-green-600 text-white py-5 rounded-3xl font-bold hover:bg-green-700 transition flex items-center justify-center space-x-3 shadow-xl">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg>
                        <span>Download Professional Certificate</span>
                    </button>
                    <button onclick="location.reload()" class="w-full text-slate-500 font-bold text-xs uppercase tracking-widest">Return to Home</button>
                </div>

                <div id="fail-actions" class="hidden">
                    <button onclick="location.reload()" class="w-full bg-slate-900 text-white py-5 rounded-3xl font-bold shadow-xl">Try Assessment Again</button>
                </div>
            </div>
        </section>

        <!-- Admin -->
        <section id="view-admin-login" class="hidden max-w-sm mx-auto bg-white p-10 rounded-3xl shadow-xl border">
            <h2 class="text-xl font-bold text-center mb-6">Admin Panel</h2>
            <div class="space-y-4">
                <input type="password" id="admin-pin" class="w-full px-5 py-4 bg-slate-50 border rounded-2xl outline-none focus:border-blue-600" placeholder="Enter PIN (2024)">
                <button onclick="app.adminAuth()" class="w-full bg-blue-900 text-white py-4 rounded-2xl font-bold shadow-lg">Login</button>
                <button onclick="app.showPage('registration')" class="w-full text-xs font-bold text-slate-400">Cancel</button>
            </div>
        </section>

        <section id="view-admin-dashboard" class="hidden space-y-6">
            <div class="flex justify-between items-center">
                <h2 class="text-2xl font-black text-blue-900">Result Dashboard</h2>
                <button onclick="location.reload()" class="text-xs bg-slate-200 px-4 py-2 rounded-lg font-bold">Sign Out</button>
            </div>
            <div class="bg-white rounded-3xl shadow-sm border overflow-hidden">
                <div class="overflow-x-auto">
                    <table class="w-full text-left text-xs">
                        <thead class="bg-slate-50 text-slate-400 font-black uppercase tracking-tighter">
                            <tr>
                                <th class="p-5">Candidate</th>
                                <th class="p-5">Course</th>
                                <th class="p-5">Result</th>
                                <th class="p-5">Security</th>
                                <th class="p-5">Action</th>
                            </tr>
                        </thead>
                        <tbody id="admin-data-list" class="divide-y divide-slate-100">
                            <!-- Admin data rows -->
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

    </main>

    <!-- Global Alert Modal -->
    <div id="modal-alert" class="fixed inset-0 bg-black/70 hidden z-[100] flex items-center justify-center p-6 backdrop-blur-sm">
        <div class="bg-white p-8 rounded-[2rem] max-w-sm w-full text-center shadow-2xl scale-100 transition-transform">
            <div id="modal-icon" class="text-4xl mb-4">üì¢</div>
            <h3 id="modal-title" class="text-xl font-black mb-2 text-slate-800">Alert</h3>
            <p id="modal-msg" class="text-sm text-slate-500 mb-8 leading-relaxed"></p>
            <button onclick="app.hideModal()" class="w-full bg-blue-900 text-white py-4 rounded-2xl font-bold shadow-lg">Understood</button>
        </div>
    </div>

    <!-- Firebase Scripts -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js';
        import { getAuth, signInAnonymously } from 'https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js';
        import { getFirestore, doc, setDoc, collection, onSnapshot, query, orderBy } from 'https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js';

        const firebaseConfig = {
            apiKey: "",
            authDomain: "oriontec-c5d72.firebaseapp.com",
            projectId: "oriontec-c5d72",
            storageBucket: "oriontec-c5d72.firebasestorage.app",
            messagingSenderId: "191363451373",
            appId: "1:191363451373:web:92cbdc14d5009819d97fe4"
        };

        const fbApp = initializeApp(firebaseConfig);
        const auth = getAuth(fbApp);
        const db = getFirestore(fbApp);
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'oriontec-exams-v2';

        const QUESTIONS_SET = {
            "IT Fundamentals": [
                { q: "What is the primary brain of the computer?", a: ["RAM", "Monitor", "CPU", "GPU"], c: 2 },
                { q: "Which protocol ensures encrypted web traffic?", a: ["HTTP", "HTTPS", "FTP", "SMTP"], c: 1 },
                { q: "Which part stores data permanently?", a: ["CPU", "Hard Drive", "RAM", "Mouse"], c: 1 },
                { q: "A 'Bit' is the smallest unit of:", a: ["Data", "Hardware", "Screen", "Sound"], c: 0 },
                { q: "What does 'WWW' stand for?", a: ["World Wide Web", "World Word Web", "Web Wide World", "World Wide Work"], c: 0 }
            ],
            "Digital Literacy": [
                { q: "Deleting a file moves it to:", a: ["Documents", "Recycle Bin", "Desktop", "Internet"], c: 1 },
                { q: "Which key is used to capitalize letters?", a: ["Enter", "Shift", "Delete", "Esc"], c: 1 },
                { q: "What is the shortcut key for 'Undo'?", a: ["Ctrl+U", "Ctrl+Z", "Ctrl+Y", "Ctrl+X"], c: 1 },
                { q: "CC in emails stands for:", a: ["Cloud Copy", "Client Copy", "Carbon Copy", "Critical Code"], c: 2 },
                { q: "Which software manages spreadsheets?", a: ["MS Word", "MS Excel", "MS PowerPoint", "MS Outlook"], c: 1 }
            ],
            "Web Development": [
                { q: "What does HTML stand for?", a: ["Hyper Text Markup Language", "Home Tool Markup Logic", "High Tech Multi Link", "Hyper Tool Multi Level"], c: 0 },
                { q: "Which language styles web pages?", a: ["Python", "SQL", "CSS", "PHP"], c: 2 },
                { q: "The standard port for HTTPS is:", a: ["80", "21", "443", "25"], c: 2 },
                { q: "Which tag is used for images?", a: ["<pic>", "<image>", "<img>", "<src>"], c: 2 },
                { q: "React is a framework created by:", a: ["Google", "Meta", "Microsoft", "Twitter"], c: 1 }
            ]
        };

        const app = {
            state: {
                candidate: null,
                questions: [],
                answers: [],
                currentIdx: 0,
                timer: 600,
                interval: null,
                violations: 0,
                finished: false,
                passed: false
            },

            async init() {
                await signInAnonymously(auth);
                this.showPage('registration');
            },

            showPage(id) {
                const views = ['registration', 'exam', 'result', 'admin-login', 'admin-dashboard'];
                views.forEach(v => {
                    const el = document.getElementById(`view-${v}`);
                    if (el) el.classList.add('hidden');
                });
                const target = document.getElementById(`view-${id}`);
                if (target) target.classList.remove('hidden');
                window.scrollTo(0, 0);
            },

            handleRegistration(e) {
                e.preventDefault();
                const fd = new FormData(e.target);
                
                this.state.candidate = {
                    name: fd.get('name'),
                    email: fd.get('email'),
                    course: fd.get('course'),
                    id: 'OT-' + Math.random().toString(36).substr(2, 6).toUpperCase()
                };

                // Initialize questions based on course
                this.state.questions = QUESTIONS_SET[this.state.candidate.course] || [];
                this.state.answers = new Array(this.state.questions.length).fill(null);
                
                // Show test UI
                this.startExam();
            },

            startExam() {
                this.showPage('exam');
                
                // Set Header Info
                document.getElementById('active-session').classList.remove('hidden');
                document.getElementById('nav-user-name').innerText = this.state.candidate.name;
                document.getElementById('exam-course-title').innerText = this.state.candidate.course;
                document.getElementById('exam-candidate-name').innerText = "Candidate ID: " + this.state.candidate.id;

                this.renderQuestion();
                this.renderPalette();

                // Start Timer
                this.state.interval = setInterval(() => {
                    this.state.timer--;
                    this.updateTimerUI();
                    if(this.state.timer <= 0) this.autoSubmit();
                }, 1000);

                // Anti-Cheat (Tab Switch)
                document.addEventListener('visibilitychange', () => {
                    if(document.hidden && !this.state.finished) {
                        this.state.violations++;
                        this.handleViolation();
                    }
                });
            },

            updateTimerUI() {
                const mins = Math.floor(this.state.timer / 60);
                const secs = this.state.timer % 60;
                const el = document.getElementById('timer');
                el.innerText = `${mins}:${secs.toString().padStart(2, '0')}`;
                if(this.state.timer < 60) el.classList.add('timer-red');
            },

            handleViolation() {
                this.showModal("Security Violation", "Tab switch detected! Ye aapke security record me log kiya jayega.");
                const si = document.getElementById('security-indicator');
                const ss = document.getElementById('security-score');
                si.classList.replace('bg-green-50', 'bg-red-50');
                ss.innerText = "Flagged (" + this.state.violations + ")";
                ss.className = "text-xs font-black text-red-600";
            },

            renderQuestion() {
                const q = this.state.questions[this.state.currentIdx];
                const container = document.getElementById('question-container');
                const sel = this.state.answers[this.state.currentIdx];

                container.innerHTML = `
                    <div class="mb-4 text-slate-400 font-bold text-[10px] uppercase tracking-widest">Question ${this.state.currentIdx + 1} of ${this.state.questions.length}</div>
                    <h4 class="text-2xl font-bold text-slate-800 mb-8 leading-snug">${q.q}</h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        ${q.a.map((opt, i) => `
                            <button onclick="app.selectOption(${i})" class="option-btn p-5 rounded-2xl border-2 border-slate-100 transition-all text-left flex items-center group ${sel === i ? 'selected-option' : ''}">
                                <div class="w-8 h-8 rounded-lg flex items-center justify-center font-bold mr-4 ${sel === i ? 'bg-blue-600 text-white' : 'bg-slate-100 text-slate-400 group-hover:bg-blue-100'}">${String.fromCharCode(65+i)}</div>
                                <span class="font-semibold ${sel === i ? 'text-blue-900' : 'text-slate-600'}">${opt}</span>
                            </button>
                        `).join('')}
                    </div>
                `;

                document.getElementById('btn-prev').disabled = this.state.currentIdx === 0;
                document.getElementById('btn-next').innerText = this.state.currentIdx === this.state.questions.length - 1 ? 'Submit Test' : 'Next';
            },

            renderPalette() {
                const p = document.getElementById('palette-container');
                p.innerHTML = this.state.questions.map((_, i) => `
                    <button onclick="app.jumpTo(${i})" class="w-full aspect-square rounded-xl text-xs font-bold border-2 transition ${this.state.currentIdx === i ? 'border-blue-600 bg-blue-50 text-blue-900' : (this.state.answers[i] !== null ? 'bg-blue-900 border-blue-900 text-white' : 'border-slate-100 text-slate-300')}">
                        ${i + 1}
                    </button>
                `).join('');
            },

            selectOption(i) {
                this.state.answers[this.state.currentIdx] = i;
                this.renderQuestion();
                this.renderPalette();
            },

            jumpTo(i) {
                this.state.currentIdx = i;
                this.renderQuestion();
                this.renderPalette();
            },

            prevQuestion() {
                if(this.state.currentIdx > 0) this.jumpTo(this.state.currentIdx - 1);
            },

            nextQuestion() {
                if(this.state.currentIdx < this.state.questions.length - 1) {
                    this.jumpTo(this.state.currentIdx + 1);
                } else {
                    this.autoSubmit();
                }
            },

            async autoSubmit() {
                if(this.state.finished) return;
                this.state.finished = true;
                clearInterval(this.state.interval);
                
                // Calculate Score
                const score = this.state.answers.reduce((acc, val, i) => val === this.state.questions[i].c ? acc + 1 : acc, 0);
                const perc = Math.round((score / this.state.questions.length) * 100);
                this.state.passed = perc >= 60;

                const finalData = {
                    candidate: this.state.candidate,
                    score: perc,
                    correct: score,
                    violations: this.state.violations,
                    passed: this.state.passed,
                    timestamp: new Date().toISOString()
                };

                // Save to Firebase
                try {
                    await setDoc(doc(db, 'artifacts', appId, 'public', 'data', 'exams', finalData.candidate.id), finalData);
                } catch(err) { console.error("Firebase Error:", err); }

                this.showResultUI(finalData);
            },

            showResultUI(res) {
                this.showPage('result');
                document.getElementById('res-score').innerText = res.score + "%";
                document.getElementById('res-status').innerText = res.passed ? 'QUALIFIED' : 'FAILED';
                document.getElementById('res-status').className = `text-2xl font-black ${res.passed ? 'text-green-600' : 'text-red-600'}`;

                if(res.passed) {
                    document.getElementById('res-icon').innerHTML = "üìú";
                    document.getElementById('res-icon').className += " bg-green-100 text-green-600";
                    document.getElementById('res-msg').innerText = "Congratulations! Aapne assessment pass kar liya hai. Aap ab apna digital certificate download kar sakte hain.";
                    document.getElementById('pass-actions').classList.remove('hidden');
                } else {
                    document.getElementById('res-icon').innerHTML = "üìù";
                    document.getElementById('res-icon').className += " bg-red-100 text-red-600";
                    document.getElementById('res-msg').innerText = "Aap minimum 60% score nahi kar paye. Kripya dobara mehnat karke try karein.";
                    document.getElementById('fail-actions').classList.remove('hidden');
                }
            },

            downloadCertificate() {
                const { jsPDF } = window.jspdf;
                const docCert = new jsPDF('l', 'mm', 'a4');
                const c = this.state.candidate;
                const date = new Date().toLocaleDateString();

                docCert.setDrawColor(30, 58, 138);
                docCert.setLineWidth(1);
                docCert.rect(5, 5, 287, 200);
                docCert.setLineWidth(2);
                docCert.rect(10, 10, 277, 190);

                docCert.setFont("helvetica", "bold");
                docCert.setFontSize(44);
                docCert.setTextColor(30, 58, 138);
                docCert.text("Certificate of Achievement", 148, 55, {align: 'center'});
                
                docCert.setFontSize(16);
                docCert.setTextColor(100);
                docCert.setFont("helvetica", "normal");
                docCert.text("Oriontec Education Board - Professional Assessment", 148, 65, {align: 'center'});

                docCert.setFontSize(18);
                docCert.text("This is to certify that", 148, 90, {align: 'center'});
                
                docCert.setFontSize(32);
                docCert.setTextColor(0);
                docCert.setFont("helvetica", "bold");
                docCert.text(c.name.toUpperCase(), 148, 105, {align: 'center'});

                docCert.setFontSize(16);
                docCert.setFont("helvetica", "normal");
                docCert.setTextColor(100);
                docCert.text("has successfully qualified the online evaluation for", 148, 120, {align: 'center'});

                docCert.setFontSize(22);
                docCert.setTextColor(30, 58, 138);
                docCert.setFont("helvetica", "bold");
                docCert.text(c.course, 148, 135, {align: 'center'});

                docCert.setFontSize(10);
                docCert.setTextColor(150);
                docCert.text(`Ref ID: ${c.id} | Verified: ${date} | Verifiable at oriontec.edu`, 148, 155, {align: 'center'});

                docCert.setFont("times", "italic");
                docCert.setFontSize(18);
                docCert.setTextColor(30);
                docCert.text("Chairman - Oriontec Board", 220, 175, {align: 'center'});
                docCert.line(180, 168, 260, 168);

                docCert.save(`Oriontec_Cert_${c.id}.pdf`);
            },

            showModal(title, msg) {
                document.getElementById('modal-title').innerText = title;
                document.getElementById('modal-msg').innerText = msg;
                document.getElementById('modal-alert').classList.remove('hidden');
            },

            hideModal() {
                document.getElementById('modal-alert').classList.add('hidden');
            },

            adminAuth() {
                const pin = document.getElementById('admin-pin').value;
                if(pin === "2024") {
                    this.showPage('admin-dashboard');
                    this.loadAdminData();
                } else alert("Invalid PIN");
            },

            loadAdminData() {
                const list = document.getElementById('admin-data-list');
                const q = query(collection(db, 'artifacts', appId, 'public', 'data', 'exams'), orderBy('timestamp', 'desc'));
                onSnapshot(q, (snap) => {
                    list.innerHTML = "";
                    snap.forEach(d => {
                        const dat = d.data();
                        const row = `
                            <tr class="hover:bg-slate-50">
                                <td class="p-5 font-bold">${dat.candidate.name}<br><span class="text-[9px] text-slate-400 font-mono">${dat.candidate.id}</span></td>
                                <td class="p-5 text-slate-500">${dat.candidate.course}</td>
                                <td class="p-5 font-black ${dat.passed?'text-green-600':'text-red-600'}">${dat.score}%</td>
                                <td class="p-5 text-red-400 font-bold">${dat.violations} Switches</td>
                                <td class="p-5"><button onclick="alert('Email: ${dat.candidate.email}')" class="text-blue-600 font-bold">Details</button></td>
                            </tr>
                        `;
                        list.innerHTML += row;
                    });
                });
            }
        };

        window.app = app;
        window.onload = () => app.init();
    </script>
</body>
</html>

