<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Oriontec Education Board | Online Assessment Portal</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&family=Dancing+Script:wght@600&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .hidden { display: none !important; }
        .timer-warning { color: #ef4444; animation: pulse 1s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.6; } }
        .step-number { width: 24px; height: 24px; display: flex; align-items: center; justify-content: center; border-radius: 50%; background: #1e3a8a; color: white; font-size: 12px; font-weight: bold; }
    </style>
</head>
<body class="bg-slate-50 text-slate-900 min-h-screen">

    <!-- Navbar -->
    <nav class="bg-white border-b sticky top-0 z-50 px-6 py-3 shadow-sm">
        <div class="max-w-7xl mx-auto flex justify-between items-center">
            <div class="flex items-center space-x-3">
                <div class="w-10 h-10 bg-blue-900 rounded-lg flex items-center justify-center text-white font-bold text-xl">O</div>
                <div>
                    <h1 class="font-bold text-blue-900 leading-tight">Oriontec</h1>
                    <p class="text-[10px] uppercase tracking-widest text-slate-500 font-bold">Education Board</p>
                </div>
            </div>
            <div id="status-badge" class="hidden flex items-center space-x-2 bg-blue-50 px-3 py-1 rounded-full border border-blue-100">
                <div class="w-2 h-2 bg-blue-600 rounded-full animate-ping"></div>
                <span id="active-user" class="text-xs font-bold text-blue-900">Session Active</span>
            </div>
            <button onclick="app.showPage('admin-login')" class="text-[10px] font-black text-slate-300 hover:text-blue-900 uppercase tracking-tighter">Admin Portal</button>
        </div>
    </nav>

    <main class="max-w-6xl mx-auto p-4 md:p-10">
        
        <!-- View: Registration & Instructions -->
        <section id="view-registration" class="grid grid-cols-1 lg:grid-cols-12 gap-10">
            <!-- Left: Guidelines -->
            <div class="lg:col-span-5 space-y-6">
                <div class="bg-white p-8 rounded-3xl shadow-xl border border-slate-200">
                    <h2 class="text-2xl font-bold text-blue-900 mb-6">Candidate Guidelines</h2>
                    <p class="text-sm text-slate-500 mb-6">Please follow these instructions for the Online Assessment:</p>
                    
                    <div class="space-y-6">
                        <div class="flex space-x-4">
                            <div class="step-number">1</div>
                            <div>
                                <h4 class="font-bold text-slate-800 text-sm">Official Registration</h4>
                                <p class="text-xs text-slate-500">Enter your full legal name as it should appear on your digital certificate.</p>
                            </div>
                        </div>
                        <div class="flex space-x-4">
                            <div class="step-number">2</div>
                            <div>
                                <h4 class="font-bold text-slate-800 text-sm">Select Subject</h4>
                                <p class="text-xs text-slate-500">Choose your specific course to load the standardized test modules.</p>
                            </div>
                        </div>
                        <div class="flex space-x-4">
                            <div class="step-number">3</div>
                            <div>
                                <h4 class="font-bold text-slate-800 text-sm">Security Policy</h4>
                                <p class="text-xs text-slate-500">Do not switch tabs or minimize the window. All navigation incidents are logged.</p>
                            </div>
                        </div>
                        <div class="flex space-x-4">
                            <div class="step-number">4</div>
                            <div>
                                <h4 class="font-bold text-slate-800 text-sm">Instant Certification</h4>
                                <p class="text-xs text-slate-500">A minimum score of 60% is required to generate the official certificate.</p>
                            </div>
                        </div>
                    </div>

                    <div class="mt-8 pt-6 border-t border-slate-100 flex items-center space-x-3 text-blue-600">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"></path></svg>
                        <span class="text-xs font-bold uppercase tracking-widest">Authorized Assessment Environment</span>
                    </div>
                </div>
            </div>

            <!-- Right: Registration Form -->
            <div class="lg:col-span-7">
                <div class="bg-white p-8 rounded-3xl shadow-xl border border-slate-200">
                    <form id="regForm" class="space-y-6" onsubmit="app.handleRegistration(event)">
                        <div class="text-center mb-6">
                            <h2 class="text-xl font-bold">Initialize Session</h2>
                            <p class="text-xs text-slate-400">Enter candidate credentials to start</p>
                        </div>
                        
                        <div class="space-y-1">
                            <label class="text-[10px] font-bold text-slate-400 uppercase tracking-wider">Candidate Full Name</label>
                            <input type="text" name="name" required class="w-full px-4 py-4 rounded-xl bg-slate-50 border-2 border-slate-100 focus:border-blue-600 outline-none transition text-sm" placeholder="e.g. Rahul Sharma">
                        </div>

                        <div class="space-y-1">
                            <label class="text-[10px] font-bold text-slate-400 uppercase tracking-wider">Email Address</label>
                            <input type="email" name="email" required class="w-full px-4 py-4 rounded-xl bg-slate-50 border-2 border-slate-100 focus:border-blue-600 outline-none transition text-sm" placeholder="email@example.com">
                        </div>

                        <div class="space-y-1">
                            <label class="text-[10px] font-bold text-slate-400 uppercase tracking-wider">Select Assessment Course</label>
                            <select name="course" required class="w-full px-4 py-4 rounded-xl bg-slate-50 border-2 border-slate-100 focus:border-blue-600 outline-none transition text-sm">
                                <option value="">Select a Course...</option>
                                <option value="IT Fundamentals">IT Fundamentals</option>
                                <option value="Digital Literacy">Digital Literacy & Office Suite</option>
                                <option value="Web Development">Full Stack Web Development</option>
                            </select>
                        </div>

                        <div class="p-4 bg-blue-50 rounded-2xl border border-blue-100 flex items-start space-x-3">
                            <input type="checkbox" required class="mt-1 w-4 h-4 text-blue-600 rounded">
                            <p class="text-[11px] text-blue-800 font-medium leading-relaxed">
                                I confirm that the information provided is accurate, and I agree to abide by the Oriontec Academic Integrity Policy during this assessment.
                            </p>
                        </div>

                        <button type="submit" id="btn-start" class="w-full bg-blue-900 text-white py-4 rounded-2xl font-black uppercase tracking-widest hover:bg-blue-800 shadow-xl transition-all duration-300">
                            Begin Assessment
                        </button>
                    </form>
                </div>
            </div>
        </section>

        <!-- View: Examination -->
        <section id="view-exam" class="hidden">
            <div class="flex flex-col lg:flex-row gap-8">
                <!-- Main Test Area -->
                <div class="flex-1">
                    <div class="bg-white rounded-3xl shadow-xl p-8 border border-slate-200 min-h-[500px] flex flex-col relative">
                        <div class="flex flex-col md:flex-row md:justify-between md:items-center mb-8 gap-4 border-b pb-6">
                            <div>
                                <h3 id="display-course" class="text-xl font-bold text-blue-900">Course Assessment</h3>
                                <p id="display-name" class="text-xs font-semibold text-slate-400 uppercase tracking-widest"></p>
                            </div>
                            <div class="bg-slate-900 text-white px-6 py-2 rounded-2xl flex items-center space-x-4">
                                <span class="text-[10px] font-bold text-slate-400 uppercase">Remaining</span>
                                <span id="timer" class="text-xl font-mono font-bold">10:00</span>
                            </div>
                        </div>

                        <div id="question-box" class="flex-1">
                            <!-- Questions Rendered Here -->
                        </div>

                        <div class="flex justify-between items-center mt-10 pt-6 border-t border-slate-100">
                            <button onclick="app.prevQ()" id="btn-prev" class="px-8 py-3 rounded-xl border-2 border-slate-100 font-bold text-slate-400 hover:bg-slate-50 disabled:opacity-30">Previous</button>
                            <button onclick="app.nextQ()" id="btn-next" class="px-10 py-3 rounded-xl bg-blue-900 text-white font-bold hover:bg-blue-800 shadow-xl transition">Next</button>
                        </div>
                    </div>
                </div>

                <!-- Side Bar: Info & Palette -->
                <div class="w-full lg:w-72 space-y-6">
                    <div class="bg-white p-6 rounded-2xl border border-slate-200 shadow-sm">
                        <p class="text-[10px] font-black text-slate-400 uppercase mb-4">Integrity Status</p>
                        <div id="security-box" class="p-3 bg-green-50 rounded-xl border border-green-100 flex items-center justify-between">
                            <span class="text-xs font-bold text-green-700">Security Score:</span>
                            <span id="security-level" class="text-xs font-black text-green-700">100%</span>
                        </div>
                        <p class="text-[10px] text-slate-400 mt-4 leading-relaxed">
                            Navigation monitoring is active. Do not exit full-screen or switch windows.
                        </p>
                    </div>

                    <div class="bg-white p-6 rounded-2xl border border-slate-200 shadow-sm">
                        <p class="text-[10px] font-black text-slate-400 uppercase mb-4">Question Palette</p>
                        <div id="palette" class="grid grid-cols-5 gap-2"></div>
                    </div>
                </div>
            </div>
        </section>

        <!-- View: Results -->
        <section id="view-result" class="hidden max-w-2xl mx-auto">
            <div class="bg-white rounded-[2.5rem] shadow-2xl p-12 text-center border border-slate-200">
                <div id="res-icon" class="w-24 h-24 mx-auto rounded-full flex items-center justify-center text-4xl mb-8"></div>
                <h2 id="res-title" class="text-3xl font-black text-slate-800 mb-2">Result Analysis</h2>
                <p id="res-msg" class="text-slate-500 mb-10 max-w-sm mx-auto text-sm"></p>

                <div class="grid grid-cols-2 gap-4 mb-10">
                    <div class="bg-slate-50 p-6 rounded-3xl border border-slate-100">
                        <p class="text-[10px] font-bold text-slate-400 uppercase mb-1">Final Score</p>
                        <p id="res-perc" class="text-3xl font-black text-blue-900">0%</p>
                    </div>
                    <div class="bg-slate-50 p-6 rounded-3xl border border-slate-100">
                        <p class="text-[10px] font-bold text-slate-400 uppercase mb-1">Status</p>
                        <p id="res-status" class="text-3xl font-black">--</p>
                    </div>
                </div>

                <div id="pass-options" class="hidden space-y-4">
                    <button onclick="app.downloadCertificate()" class="w-full bg-green-600 text-white py-5 rounded-3xl font-bold hover:bg-green-700 transition-all flex items-center justify-center space-x-3 shadow-lg">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg>
                        <span>Download Certificate</span>
                    </button>
                    <button onclick="window.print()" class="w-full text-slate-500 font-bold text-xs uppercase tracking-widest hover:text-slate-800 transition">Print Performance Report</button>
                </div>

                <div id="fail-options" class="hidden">
                    <button onclick="location.reload()" class="w-full bg-slate-900 text-white py-5 rounded-3xl font-bold shadow-xl">Re-attempt Assessment</button>
                </div>
            </div>
        </section>

        <!-- Admin Portal -->
        <section id="view-admin-login" class="hidden max-w-sm mx-auto bg-white p-8 rounded-3xl shadow-xl border">
            <h2 class="text-xl font-bold text-center mb-6">Database Admin</h2>
            <div class="space-y-4">
                <input type="password" id="admin-pin" class="w-full px-4 py-3 bg-slate-50 border rounded-xl outline-none focus:border-blue-600" placeholder="Security PIN">
                <button onclick="app.adminLogin()" class="w-full bg-blue-900 text-white py-3 rounded-xl font-bold">Access Records</button>
                <button onclick="app.showPage('registration')" class="w-full text-xs font-bold text-slate-400 uppercase">Exit Portal</button>
            </div>
        </section>

        <section id="view-admin-dash" class="hidden space-y-6">
            <div class="flex justify-between items-center">
                <h2 class="text-2xl font-black text-blue-900">Assessment Oversight</h2>
                <button onclick="location.reload()" class="text-xs bg-slate-200 px-4 py-2 rounded-lg font-bold">Logout</button>
            </div>
            <div class="bg-white rounded-3xl shadow-sm border overflow-hidden">
                <table class="w-full text-left text-xs">
                    <thead class="bg-slate-50 text-slate-400 font-black uppercase">
                        <tr>
                            <th class="p-5">Candidate</th>
                            <th class="p-5">Course</th>
                            <th class="p-5">Score</th>
                            <th class="p-5">Violations</th>
                            <th class="p-5">Timestamp</th>
                        </tr>
                    </thead>
                    <tbody id="admin-data" class="divide-y divide-slate-100"></tbody>
                </table>
            </div>
        </section>

    </main>

    <!-- Global Modals -->
    <div id="modal" class="fixed inset-0 bg-black/70 hidden z-[100] flex items-center justify-center p-6 backdrop-blur-sm">
        <div class="bg-white p-8 rounded-[2rem] max-w-sm w-full text-center shadow-2xl">
            <div id="modal-icon" class="text-4xl mb-4">ðŸ“¢</div>
            <h3 id="modal-title" class="text-xl font-black mb-2 text-slate-800">Alert</h3>
            <p id="modal-msg" class="text-sm text-slate-500 mb-8"></p>
            <button onclick="app.hideModal()" class="w-full bg-blue-900 text-white py-3 rounded-2xl font-bold">Acknowledge</button>
        </div>
    </div>

    <!-- Logic -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js';
        import { getAuth, signInAnonymously } from 'https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js';
        import { getFirestore, doc, setDoc, collection, onSnapshot, query, orderBy } from 'https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js';

        const firebaseConfig = {
            apiKey: "",
            authDomain: "oriontec-c5d72.firebaseapp.com",
            projectId: "oriontec-c5d72",
            storageBucket: "oriontec-c5d72.firebasestorage.app",
            messagingSenderId: "191363451373",
            appId: "1:191363451373:web:92cbdc14d5009819d97fe4"
        };

        const fbApp = initializeApp(firebaseConfig);
        const auth = getAuth(fbApp);
        const db = getFirestore(fbApp);
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'oriontec-v2-main';

        const QUESTIONS_DB = {
            "IT Fundamentals": [
                { q: "What is the primary role of the CPU?", a: ["Storage", "Power Supply", "Logic & Calculation", "Display"], c: 2 },
                { q: "Which protocol ensures encrypted web traffic?", a: ["HTTP", "HTTPS", "FTP", "SMTP"], c: 1 },
                { q: "What does GUI stand for?", a: ["Global User Index", "General Unit Interface", "Graphical User Interface", "Global Utility Info"], c: 2 },
                { q: "Which part is considered volatile memory?", a: ["Hard Drive", "SSD", "RAM", "CD-ROM"], c: 2 },
                { q: "A 'Firewall' is primarily used for:", a: ["Speed", "Cooling", "Security", "Storage"], c: 2 }
            ],
            "Digital Literacy": [
                { q: "Which shortcut key is used for 'Undo'?", a: ["Ctrl+U", "Ctrl+Z", "Ctrl+Y", "Ctrl+X"], c: 1 },
                { q: "A strong password should typically have:", a: ["Short length", "Only numbers", "Mix of characters & symbols", "Your name"], c: 2 },
                { q: "Which software manages spreadsheets?", a: ["MS Word", "MS Excel", "MS PowerPoint", "MS Outlook"], c: 1 },
                { q: "Bcc in email stands for:", a: ["Business Carbon Copy", "Base Code Check", "Blind Carbon Copy", "Backup Client Copy"], c: 2 },
                { q: "Phishing is a method used to:", a: ["Download games", "Steal sensitive info", "Speed up internet", "Clean viruses"], c: 1 }
            ],
            "Web Development": [
                { q: "What provides the skeleton of a webpage?", a: ["CSS", "JavaScript", "HTML", "PHP"], c: 2 },
                { q: "Which CSS property defines background color?", a: ["font-color", "color", "background-color", "bgColor"], c: 2 },
                { q: "Which tag creates a hyperlink?", a: ["<link>", "<a>", "<href>", "<url>"], c: 1 },
                { q: "The 'V' in MVC stands for:", a: ["Variable", "Vector", "View", "Version"], c: 2 },
                { q: "JavaScript is primarily a:", a: ["Server language", "Client-side script", "Markup language", "Database tool"], c: 1 }
            ]
        };

        const app = {
            state: {
                candidate: null,
                questions: [],
                answers: [],
                currentIdx: 0,
                timer: 600,
                interval: null,
                violations: 0,
                finished: false
            },

            async init() {
                await signInAnonymously(auth);
                this.showPage('registration');
            },

            showPage(id) {
                const views = ['registration', 'exam', 'result', 'admin-login', 'admin-dash'];
                views.forEach(v => document.getElementById(`view-${v}`).classList.add('hidden'));
                document.getElementById(`view-${id}`).classList.remove('hidden');
                window.scrollTo(0, 0);
            },

            handleRegistration(e) {
                e.preventDefault();
                const fd = new FormData(e.target);
                this.state.candidate = {
                    name: fd.get('name'),
                    email: fd.get('email'),
                    course: fd.get('course'),
                    id: 'OT-' + Math.random().toString(36).substr(2, 6).toUpperCase()
                };

                this.state.questions = QUESTIONS_DB[this.state.candidate.course] || [];
                this.state.answers = new Array(this.state.questions.length).fill(null);
                
                this.startExam();
            },

            startExam() {
                this.showPage('exam');
                document.getElementById('status-badge').classList.remove('hidden');
                document.getElementById('display-course').innerText = this.state.candidate.course;
                document.getElementById('display-name').innerText = this.state.candidate.name;

                this.renderQuestion();
                this.renderPalette();

                this.state.interval = setInterval(() => {
                    this.state.timer--;
                    this.updateTimer();
                    if(this.state.timer <= 0) this.finish();
                }, 1000);

                document.addEventListener('visibilitychange', () => {
                    if(document.hidden && !this.state.finished) {
                        this.state.violations++;
                        this.showModal("Security Notice", "Tab switching or window minimization detected. This incident has been logged for review.");
                        const sl = document.getElementById('security-level');
                        sl.innerText = Math.max(0, 100 - (this.state.violations * 20)) + "%";
                        document.getElementById('security-box').classList.replace('bg-green-50', 'bg-red-50');
                        document.getElementById('security-box').classList.replace('text-green-700', 'text-red-700');
                    }
                });
            },

            updateTimer() {
                const m = Math.floor(this.state.timer / 60);
                const s = this.state.timer % 60;
                const el = document.getElementById('timer');
                el.innerText = `${m}:${s.toString().padStart(2, '0')}`;
                if(this.state.timer < 60) el.classList.add('timer-warning');
            },

            renderQuestion() {
                const q = this.state.questions[this.state.currentIdx];
                const box = document.getElementById('question-box');
                const sel = this.state.answers[this.state.currentIdx];

                box.innerHTML = `
                    <p class="text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-2">Question ${this.state.currentIdx+1} / ${this.state.questions.length}</p>
                    <h4 class="text-xl font-bold text-slate-800 mb-8">${q.q}</h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        ${q.a.map((opt, i) => `
                            <button onclick="app.pick(${i})" class="flex items-center p-5 rounded-2xl border-2 transition-all text-left group ${sel === i ? 'border-blue-600 bg-blue-50' : 'border-slate-100 hover:border-slate-200'}">
                                <div class="w-8 h-8 rounded-lg flex items-center justify-center font-bold mr-4 ${sel === i ? 'bg-blue-600 text-white' : 'bg-slate-100 text-slate-400 group-hover:bg-slate-200'}">${String.fromCharCode(65+i)}</div>
                                <span class="font-semibold ${sel === i ? 'text-blue-900' : 'text-slate-600'}">${opt}</span>
                            </button>
                        `).join('')}
                    </div>
                `;

                document.getElementById('btn-prev').disabled = this.state.currentIdx === 0;
                document.getElementById('btn-next').innerText = this.state.currentIdx === this.state.questions.length - 1 ? 'Complete Assessment' : 'Next';
            },

            renderPalette() {
                const p = document.getElementById('palette');
                p.innerHTML = this.state.questions.map((_, i) => `
                    <button onclick="app.jump(${i})" class="w-full aspect-square rounded-xl text-xs font-bold border-2 transition ${this.state.currentIdx === i ? 'border-blue-600 bg-blue-50 text-blue-900' : (this.state.answers[i] !== null ? 'bg-blue-900 border-blue-900 text-white' : 'border-slate-100 text-slate-300')}">
                        ${i+1}
                    </button>
                `).join('');
            },

            pick(i) { this.state.answers[this.state.currentIdx] = i; this.renderQuestion(); this.renderPalette(); },
            jump(i) { this.state.currentIdx = i; this.renderQuestion(); this.renderPalette(); },
            prevQ() { if(this.state.currentIdx > 0) this.jump(this.state.currentIdx - 1); },
            nextQ() { 
                if(this.state.currentIdx < this.state.questions.length - 1) this.jump(this.state.currentIdx + 1); 
                else this.finish(); 
            },

            async finish() {
                if(this.state.finished) return;
                this.state.finished = true;
                clearInterval(this.state.interval);
                
                const score = this.state.answers.reduce((acc, val, i) => val === this.state.questions[i].c ? acc + 1 : acc, 0);
                const perc = Math.round((score / this.state.questions.length) * 100);
                const passed = perc >= 60;

                const result = {
                    candidate: this.state.candidate,
                    score: perc,
                    violations: this.state.violations,
                    passed,
                    date: new Date().toISOString()
                };

                await setDoc(doc(db, 'artifacts', appId, 'public', 'data', 'exams', result.candidate.id), result);
                this.showResultUI(result);
            },

            showResultUI(res) {
                this.showPage('result');
                document.getElementById('res-perc').innerText = res.score + "%";
                document.getElementById('res-status').innerText = res.passed ? 'QUALIFIED' : 'RE-TAKE';
                document.getElementById('res-status').className = `text-3xl font-black ${res.passed ? 'text-green-600' : 'text-red-600'}`;

                if(res.passed) {
                    document.getElementById('res-icon').innerHTML = "ðŸ“œ";
                    document.getElementById('res-icon').className += " bg-green-100 text-green-600";
                    document.getElementById('res-msg').innerText = "Congratulations! You have successfully passed the Oriontec evaluation.";
                    document.getElementById('pass-options').classList.remove('hidden');
                } else {
                    document.getElementById('res-icon').innerHTML = "ðŸ“";
                    document.getElementById('res-icon').className += " bg-red-100 text-red-600";
                    document.getElementById('res-msg').innerText = "Minimum passing score is 60%. Please brush up on your skills and try again.";
                    document.getElementById('fail-options').classList.remove('hidden');
                }
            },

            downloadCertificate() {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF('l', 'mm', 'a4');
                const c = this.state.candidate;

                doc.setDrawColor(30, 58, 138);
                doc.setLineWidth(1);
                doc.rect(5, 5, 287, 200);
                doc.setLineWidth(2);
                doc.rect(10, 10, 277, 190);

                doc.setFont("helvetica", "bold");
                doc.setFontSize(48);
                doc.setTextColor(30, 58, 138);
                doc.text("Certificate of Achievement", 148, 55, {align: 'center'});
                
                doc.setFontSize(16);
                doc.setTextColor(100);
                doc.setFont("helvetica", "normal");
                doc.text("Oriontec Education Board Official Recognition", 148, 65, {align: 'center'});

                doc.setFontSize(18);
                doc.text("This high honor is presented to", 148, 90, {align: 'center'});
                
                doc.setFontSize(32);
                doc.setTextColor(0);
                doc.setFont("helvetica", "bold");
                doc.text(c.name.toUpperCase(), 148, 105, {align: 'center'});

                doc.setFontSize(16);
                doc.setFont("helvetica", "normal");
                doc.setTextColor(100);
                doc.text("for successfully qualifying the professional assessment in", 148, 120, {align: 'center'});

                doc.setFontSize(22);
                doc.setTextColor(30, 58, 138);
                doc.setFont("helvetica", "bold");
                doc.text(c.course, 148, 135, {align: 'center'});

                doc.setFontSize(10);
                doc.setTextColor(150);
                doc.text(`ID: ${c.id} | Verified: ${new Date().toLocaleDateString()} | oriontec-edu.verify`, 148, 155, {align: 'center'});

                doc.setFont("times", "italic");
                doc.setFontSize(20);
                doc.setTextColor(30);
                doc.text("Chairman - Oriontec Education Board", 220, 175, {align: 'center'});
                doc.line(180, 168, 260, 168);

                doc.save(`Oriontec_Cert_${c.id}.pdf`);
            },

            showModal(title, msg) {
                document.getElementById('modal-title').innerText = title;
                document.getElementById('modal-msg').innerText = msg;
                document.getElementById('modal').classList.remove('hidden');
            },
            hideModal() { document.getElementById('modal').classList.add('hidden'); },

            adminLogin() {
                if(document.getElementById('admin-pin').value === "2024") {
                    this.showPage('admin-dash');
                    this.loadAdminData();
                } else alert("Access Denied: Invalid PIN");
            },

            loadAdminData() {
                const q = query(collection(db, 'artifacts', appId, 'public', 'data', 'exams'), orderBy('date', 'desc'));
                onSnapshot(q, (snap) => {
                    const t = document.getElementById('admin-data');
                    t.innerHTML = "";
                    snap.forEach(d => {
                        const dat = d.data();
                        t.innerHTML += `
                            <tr class="hover:bg-slate-50 transition">
                                <td class="p-5 font-bold">${dat.candidate.name}<br><span class="text-[9px] text-slate-400 uppercase">${dat.candidate.id}</span></td>
                                <td class="p-5 text-slate-500">${dat.candidate.course}</td>
                                <td class="p-5 font-black ${dat.passed?'text-green-600':'text-red-600'}">${dat.score}%</td>
                                <td class="p-5 text-red-400 font-bold">${dat.violations} Detected</td>
                                <td class="p-5 text-slate-400 text-[10px]">${new Date(dat.date).toLocaleString()}</td>
                            </tr>
                        `;
                    });
                });
            }
        };

        window.app = app;
        app.init();
    </script>
</body>
</html>

