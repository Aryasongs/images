<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TechVisa Solutions - H1B Visa Application Portal</title>
    <style>
        /* Professional Corporate CSS */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            line-height: 1.6;
            min-height: 100vh;
        }

        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            padding: 25px 0;
            text-align: center;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grain" width="100" height="100" patternUnits="userSpaceOnUse"><circle cx="25" cy="25" r="1" fill="rgba(255,255,255,0.1)"/><circle cx="75" cy="75" r="1" fill="rgba(255,255,255,0.1)"/></pattern></defs><rect width="100" height="100" fill="url(%23grain)"/></svg>');
            opacity: 0.1;
        }

        .header-content {
            position: relative;
            z-index: 2;
        }

        .company-logo {
            display: inline-block;
            width: 60px;
            height: 60px;
            background: linear-gradient(45deg, #3498db, #2980b9);
            border-radius: 12px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: bold;
            color: white;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .header h1 {
            font-size: 32px;
            margin-bottom: 8px;
            font-weight: 700;
            letter-spacing: -0.5px;
        }

        .header .tagline {
            font-size: 18px;
            opacity: 0.9;
            font-weight: 300;
        }

        .header .subtitle {
            font-size: 14px;
            opacity: 0.8;
            margin-top: 5px;
        }

        .container {
            max-width: 900px;
            margin: 40px auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.1);
            overflow: hidden;
            position: relative;
        }

        .container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #3498db, #2980b9, #8e44ad, #9b59b6);
        }

        .form-section {
            padding: 40px;
            border-bottom: 1px solid #f1f2f6;
            position: relative;
        }

        .form-section:last-child {
            border-bottom: none;
        }

        .section-title {
            font-size: 24px;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 25px;
            position: relative;
            padding-left: 20px;
        }

        .section-title::before {
            content: '';
            position: absolute;
            left: 0;
            top: 50%;
            transform: translateY(-50%);
            width: 4px;
            height: 30px;
            background: linear-gradient(135deg, #3498db, #2980b9);
            border-radius: 2px;
        }

        .section-subtitle {
            color: #7f8c8d;
            font-size: 16px;
            margin-bottom: 30px;
            font-weight: 400;
        }

        .form-group {
            margin-bottom: 25px;
            position: relative;
        }

        .form-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 10px;
            color: #2c3e50;
            font-size: 15px;
            transition: color 0.3s ease;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 15px 20px;
            border: 2px solid #e1e8ed;
            border-radius: 12px;
            font-size: 16px;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            transition: all 0.3s ease;
            background: #fafbfc;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
            background: white;
            transform: translateY(-1px);
        }

        .form-group input:hover,
        .form-group select:hover,
        .form-group textarea:hover {
            border-color: #bdc3c7;
        }

        .form-group.focused label {
            color: #3498db;
        }

        .required {
            color: #d32f2f;
        }

        .btn {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            padding: 15px 35px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin-right: 15px;
            position: relative;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(52, 152, 219, 0.3);
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn:hover {
            background: linear-gradient(135deg, #2980b9, #3498db);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(52, 152, 219, 0.4);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .btn-secondary {
            background: linear-gradient(135deg, #95a5a6, #7f8c8d);
            box-shadow: 0 4px 15px rgba(149, 165, 166, 0.3);
        }

        .btn-secondary:hover {
            background: linear-gradient(135deg, #7f8c8d, #95a5a6);
            box-shadow: 0 6px 20px rgba(149, 165, 166, 0.4);
        }

        .btn-success {
            background: linear-gradient(135deg, #27ae60, #2ecc71);
            box-shadow: 0 4px 15px rgba(39, 174, 96, 0.3);
        }

        .btn-success:hover {
            background: linear-gradient(135deg, #2ecc71, #27ae60);
            box-shadow: 0 6px 20px rgba(39, 174, 96, 0.4);
        }

        .progress-bar {
            background: #e9ecef;
            height: 8px;
            border-radius: 4px;
            margin: 20px 0;
            overflow: hidden;
        }

        .progress-fill {
            background: linear-gradient(90deg, #1e3c72, #2a5298);
            height: 100%;
            transition: width 0.3s ease;
        }

        .step-indicator {
            text-align: center;
            margin: 20px 0;
            font-size: 14px;
            color: #666;
        }

        .acknowledgment-box {
            background: #e8f5e8;
            border: 2px solid #4caf50;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
        }

        .acknowledgment-number {
            font-size: 24px;
            font-weight: bold;
            color: #2e7d32;
            margin: 10px 0;
            letter-spacing: 2px;
        }

        .session-warning {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
            padding: 15px;
            border-radius: 4px;
            margin: 20px 0;
            text-align: center;
            display: none;
        }

        .error-message {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
            padding: 15px;
            border-radius: 4px;
            margin: 20px 0;
            display: none;
        }

        .success-message {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
            padding: 15px;
            border-radius: 4px;
            margin: 20px 0;
            display: none;
        }

        .document-checklist {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 20px;
            margin: 20px 0;
        }

        .document-item {
            display: flex;
            align-items: center;
            margin: 10px 0;
            padding: 10px;
            background: white;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        .document-item input[type="checkbox"] {
            width: auto;
            margin-right: 15px;
            transform: scale(1.2);
        }

        .appointment-info {
            background: #e3f2fd;
            border: 2px solid #2196f3;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }

        .payment-info {
            background: #fff8e1;
            border: 2px solid #ff9800;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }

        .hidden {
            display: none;
        }

        .form-row {
            display: flex;
            gap: 20px;
        }

        .form-row .form-group {
            flex: 1;
        }

        /* PDF Document Styles */
        .pdf-document {
            background: white;
            max-width: 900px;
            margin: 20px auto;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
            border: 1px solid #ddd;
        }

        .pdf-header {
            background: #f8f9fa;
            padding: 30px;
            border-bottom: 3px solid #1e3c72;
            text-align: center;
        }

        .pdf-header h1 {
            color: #1e3c72;
            font-size: 24px;
            margin-bottom: 10px;
        }

        .pdf-header .seal {
            width: 80px;
            height: 80px;
            border: 3px solid #1e3c72;
            border-radius: 50%;
            margin: 0 auto 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
            color: #1e3c72;
        }

        .pdf-content {
            padding: 40px;
        }

        .pdf-section {
            margin-bottom: 30px;
            page-break-inside: avoid;
        }

        .pdf-section h3 {
            color: #1e3c72;
            font-size: 18px;
            margin-bottom: 15px;
            border-bottom: 2px solid #1e3c72;
            padding-bottom: 5px;
        }

        .pdf-field {
            display: flex;
            margin-bottom: 12px;
            padding: 8px 0;
            border-bottom: 1px dotted #ccc;
        }

        .pdf-field .label {
            font-weight: bold;
            width: 200px;
            flex-shrink: 0;
        }

        .pdf-field .value {
            flex: 1;
            color: #333;
        }

        .pdf-footer {
            background: #f8f9fa;
            padding: 30px;
            border-top: 3px solid #1e3c72;
            text-align: center;
            font-size: 12px;
            color: #666;
        }

        .signature-section {
            display: flex;
            justify-content: space-between;
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid #ddd;
        }

        .signature-box {
            text-align: center;
            width: 200px;
        }

        .signature-line {
            border-bottom: 2px solid #333;
            margin-bottom: 10px;
            height: 50px;
        }

        .status-badge {
            display: inline-block;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 14px;
            text-transform: uppercase;
        }

        .status-submitted {
            background: #e8f5e8;
            color: #2e7d32;
            border: 2px solid #4caf50;
        }

        .status-under_review {
            background: #fff3cd;
            color: #856404;
            border: 2px solid #ffc107;
        }

        .status-documents_requested {
            background: #ffeaa7;
            color: #d68910;
            border: 2px solid #f39c12;
        }

        .status-interview_scheduled {
            background: #d1ecf1;
            color: #0c5460;
            border: 2px solid #17a2b8;
        }

        .status-approved {
            background: #d4edda;
            color: #155724;
            border: 2px solid #28a745;
        }

        .status-rejected {
            background: #f8d7da;
            color: #721c24;
            border: 2px solid #dc3545;
        }

        .status-on_hold {
            background: #e2e3e5;
            color: #383d41;
            border: 2px solid #6c757d;
        }

        .tracking-timeline {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 30px;
            margin: 20px 0;
            position: relative;
        }

        .timeline-item {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            position: relative;
            padding-left: 40px;
        }

        .timeline-item::before {
            content: '';
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #28a745;
            border: 3px solid white;
            box-shadow: 0 0 0 2px #28a745;
        }

        .timeline-item.pending::before {
            background: #6c757d;
            box-shadow: 0 0 0 2px #6c757d;
        }

        .timeline-item.current::before {
            background: #007bff;
            box-shadow: 0 0 0 2px #007bff;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 2px #007bff; }
            50% { box-shadow: 0 0 0 8px rgba(0, 123, 255, 0.3); }
            100% { box-shadow: 0 0 0 2px #007bff; }
        }

        .timeline-content {
            flex: 1;
            margin-left: 20px;
        }

        .timeline-title {
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 5px;
        }

        .timeline-date {
            font-size: 14px;
            color: #666;
            margin-bottom: 5px;
        }

        .timeline-description {
            font-size: 14px;
            color: #555;
        }

        .tracking-details {
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }

        .detail-row {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px dotted #ccc;
        }

        .detail-row:last-child {
            border-bottom: none;
        }

        .detail-label {
            font-weight: 600;
            color: #2c3e50;
        }

        .detail-value {
            color: #555;
        }

        .admin-controls {
            background: #f8f9fa;
            padding: 30px;
            border-radius: 8px;
            margin: 20px 0;
        }

        .applications-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .applications-table th,
        .applications-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #dee2e6;
        }

        .applications-table th {
            background: #1e3c72;
            color: white;
            font-weight: 600;
        }

        .applications-table tr:hover {
            background: #f8f9fa;
        }

        .auth-section {
            background: #f8f9fa;
            padding: 30px;
            border-radius: 8px;
            margin: 20px 0;
            text-align: center;
        }

        @media (max-width: 768px) {
            .container, .pdf-document {
                margin: 20px;
                border-radius: 0;
            }
            
            .form-row {
                flex-direction: column;
                gap: 0;
            }

            .pdf-field {
                flex-direction: column;
            }

            .pdf-field .label {
                width: 100%;
                margin-bottom: 5px;
            }
        }

        @media print {
            body {
                background: white;
            }
            
            .header, .btn, .progress-bar, .step-indicator {
                display: none;
            }
            
            .pdf-document {
                box-shadow: none;
                border: none;
                margin: 0;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="header-content">
            <div class="company-logo">TV</div>
            <h1>TechVisa Solutions</h1>
            <p class="tagline">Professional H1B Visa Application Portal</p>
            <p class="subtitle">Trusted by 50,000+ professionals worldwide | USCIS Authorized Partner</p>
        </div>
    </div>

    <div class="container">


        <!-- Session Warning -->
        <div id="sessionWarning" class="session-warning">
            Your session will expire in <span id="sessionTimer">30</span> seconds due to inactivity.
        </div>

        <!-- Error/Success Messages -->
        <div id="errorMessage" class="error-message"></div>
        <div id="successMessage" class="success-message"></div>

        <!-- Progress Bar -->
        <div id="progressSection" class="hidden">
            <div class="progress-bar">
                <div id="progressFill" class="progress-fill" style="width: 0%"></div>
            </div>
            <div class="step-indicator">
                Step <span id="currentStep">1</span> of 8
            </div>
        </div>

        <!-- Step 1: Initial Registration -->
        <div id="step1" class="form-section">
            <h2 class="section-title">Initial Registration</h2>
            <p class="section-subtitle">Please provide your basic information to generate your acknowledgment number and begin your H1B visa application process.</p>
            
            <div class="form-group">
                <label for="initialName">Full Name (as per passport) <span class="required">*</span></label>
                <input type="text" id="initialName" required placeholder="Enter your complete legal name">
            </div>
            
            <div class="form-group">
                <label for="initialEmail">Email Address <span class="required">*</span></label>
                <input type="email" id="initialEmail" required placeholder="your.email@example.com">
            </div>
            
            <div class="form-group">
                <label for="initialPhone">Phone Number <span class="required">*</span></label>
                <input type="tel" id="initialPhone" required placeholder="+91-XXXXXXXXXX">
            </div>
            
            <button type="button" class="btn" onclick="generateAcknowledgment()">Generate Acknowledgment Number</button>
            
            <div style="margin-top: 30px; padding-top: 20px; border-top: 1px solid #eee;">
                <h3 style="color: #1e3c72; margin-bottom: 15px;">Track Your Application</h3>
                <div class="form-group">
                    <label for="trackingAck">Enter Acknowledgment Number</label>
                    <input type="text" id="trackingAck" placeholder="ACK-XXXXXXXX">
                </div>
                <button type="button" class="btn btn-success" onclick="trackApplication()">Track Application Status</button>
            </div>
            
            <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid #eee;">
                <h3 style="color: #1e3c72; margin-bottom: 15px;">Already have an acknowledgment number?</h3>
                <div class="form-group">
                    <label for="existingAck">Enter Acknowledgment Number</label>
                    <input type="text" id="existingAck" placeholder="ACK-XXXXXXXX">
                </div>
                <button type="button" class="btn btn-secondary" onclick="loadExistingApplication()">Continue Application</button>
            </div>
            
            <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid #eee;">
                <h3 style="color: #1e3c72; margin-bottom: 15px;">Forgot your acknowledgment number?</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label for="retrieveName">Full Name</label>
                        <input type="text" id="retrieveName">
                    </div>
                    <div class="form-group">
                        <label for="retrieveDOB">Date of Birth</label>
                        <input type="date" id="retrieveDOB">
                    </div>
                </div>
                <div class="form-group">
                    <label for="retrieveEmail">Email Address</label>
                    <input type="email" id="retrieveEmail">
                </div>
                <button type="button" class="btn btn-secondary" onclick="retrieveAcknowledgment()">Retrieve Acknowledgment Number</button>
            </div>
            
            <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid #eee;">
                <h3 style="color: #1e3c72; margin-bottom: 15px;">Admin Access</h3>
                <button type="button" class="btn" style="background: linear-gradient(135deg, #e74c3c, #c0392b);" onclick="showAdminLogin()">Admin Login</button>
            </div>
        </div>

        <!-- Acknowledgment Display -->
        <div id="acknowledgmentDisplay" class="acknowledgment-box hidden">
            <h3>Acknowledgment Number Generated</h3>
            <div class="acknowledgment-number" id="ackNumber"></div>
            <p>Please save this number. It has been sent to your email address.</p>
            <p style="margin-top: 15px;"><strong>Important:</strong> You will need this number to continue your application.</p>
            <button type="button" class="btn" onclick="startApplication()">Start H1B Application</button>
        </div>

        <!-- Step 2: Personal Information -->
        <div id="step2" class="form-section hidden">
            <h2 class="section-title">Personal Information</h2>
            <p class="section-subtitle">Please provide your complete personal details as they appear on your official documents.</p>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="firstName">First Name <span class="required">*</span></label>
                    <input type="text" id="firstName" required placeholder="As per passport">
                </div>
                <div class="form-group">
                    <label for="middleName">Middle Name</label>
                    <input type="text" id="middleName" placeholder="If applicable">
                </div>
                <div class="form-group">
                    <label for="lastName">Last Name <span class="required">*</span></label>
                    <input type="text" id="lastName" required placeholder="As per passport">
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="dateOfBirth">Date of Birth <span class="required">*</span></label>
                    <input type="date" id="dateOfBirth" required>
                </div>
                <div class="form-group">
                    <label for="placeOfBirth">Place of Birth <span class="required">*</span></label>
                    <input type="text" id="placeOfBirth" required placeholder="City, State, Country">
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="gender">Gender <span class="required">*</span></label>
                    <select id="gender" required>
                        <option value="">Select Gender</option>
                        <option value="male">Male</option>
                        <option value="female">Female</option>
                        <option value="other">Other</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="religion">Religion</label>
                    <select id="religion">
                        <option value="">Select Religion</option>
                        <option value="hindu">Hindu</option>
                        <option value="muslim">Muslim</option>
                        <option value="christian">Christian</option>
                        <option value="sikh">Sikh</option>
                        <option value="buddhist">Buddhist</option>
                        <option value="jain">Jain</option>
                        <option value="other">Other</option>
                        <option value="prefer_not_to_say">Prefer not to say</option>
                    </select>
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="nationality">Nationality <span class="required">*</span></label>
                    <select id="nationality" required>
                        <option value="">Select Nationality</option>
                        <option value="indian">Indian</option>
                        <option value="other">Other</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="countryOfBirth">Country of Birth <span class="required">*</span></label>
                    <select id="countryOfBirth" required>
                        <option value="">Select Country</option>
                        <option value="india">India</option>
                        <option value="other">Other</option>
                    </select>
                </div>
            </div>
            
            <div class="form-group">
                <label for="maritalStatus">Marital Status <span class="required">*</span></label>
                <select id="maritalStatus" required>
                    <option value="">Select Status</option>
                    <option value="single">Single</option>
                    <option value="married">Married</option>
                    <option value="divorced">Divorced</option>
                    <option value="widowed">Widowed</option>
                    <option value="separated">Separated</option>
                </select>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="fatherName">Father's Full Name <span class="required">*</span></label>
                    <input type="text" id="fatherName" required placeholder="Father's complete name">
                </div>
                <div class="form-group">
                    <label for="fatherOccupation">Father's Occupation</label>
                    <input type="text" id="fatherOccupation" placeholder="Father's profession">
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="motherName">Mother's Full Name <span class="required">*</span></label>
                    <input type="text" id="motherName" required placeholder="Mother's complete name">
                </div>
                <div class="form-group">
                    <label for="motherOccupation">Mother's Occupation</label>
                    <input type="text" id="motherOccupation" placeholder="Mother's profession">
                </div>
            </div>
            
            <div class="form-group" id="spouseField" style="display: none;">
                <label for="spouseName">Spouse's Full Name</label>
                <input type="text" id="spouseName" placeholder="Spouse's complete name">
            </div>
            
            <div class="form-group" id="spouseOccupationField" style="display: none;">
                <label for="spouseOccupation">Spouse's Occupation</label>
                <input type="text" id="spouseOccupation" placeholder="Spouse's profession">
            </div>
            
            <div class="form-group">
                <label for="emergencyContact">Emergency Contact Name <span class="required">*</span></label>
                <input type="text" id="emergencyContact" required placeholder="Emergency contact person">
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="emergencyPhone">Emergency Contact Phone <span class="required">*</span></label>
                    <input type="tel" id="emergencyPhone" required placeholder="+91-XXXXXXXXXX">
                </div>
                <div class="form-group">
                    <label for="emergencyRelation">Relationship <span class="required">*</span></label>
                    <select id="emergencyRelation" required>
                        <option value="">Select Relationship</option>
                        <option value="parent">Parent</option>
                        <option value="spouse">Spouse</option>
                        <option value="sibling">Sibling</option>
                        <option value="friend">Friend</option>
                        <option value="other">Other</option>
                    </select>
                </div>
            </div>
            
            <button type="button" class="btn btn-secondary" onclick="previousStep()">Previous</button>
            <button type="button" class="btn" onclick="nextStep()">Next</button>
        </div>

        <!-- Step 3: Contact Information -->
        <div id="step3" class="form-section hidden">
            <h2 class="section-title">Contact Information</h2>
            
            <div class="form-group">
                <label for="email">Email Address <span class="required">*</span></label>
                <input type="email" id="email" required>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="phone">Phone Number <span class="required">*</span></label>
                    <input type="tel" id="phone" required placeholder="+91-XXXXXXXXXX">
                </div>
                <div class="form-group">
                    <label for="alternatePhone">Alternate Phone</label>
                    <input type="tel" id="alternatePhone" placeholder="+91-XXXXXXXXXX">
                </div>
            </div>
            
            <div class="form-group">
                <label for="currentAddress">Current Address <span class="required">*</span></label>
                <textarea id="currentAddress" rows="3" required></textarea>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="city">City <span class="required">*</span></label>
                    <input type="text" id="city" required>
                </div>
                <div class="form-group">
                    <label for="state">State <span class="required">*</span></label>
                    <input type="text" id="state" required>
                </div>
                <div class="form-group">
                    <label for="pincode">PIN Code <span class="required">*</span></label>
                    <input type="text" id="pincode" required pattern="[0-9]{6}">
                </div>
            </div>
            
            <button type="button" class="btn btn-secondary" onclick="previousStep()">Previous</button>
            <button type="button" class="btn" onclick="nextStep()">Next</button>
        </div>

        <!-- Step 4: Passport Information -->
        <div id="step4" class="form-section hidden">
            <h2 class="section-title">Passport Information</h2>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="passportNumber">Passport Number <span class="required">*</span></label>
                    <input type="text" id="passportNumber" required>
                </div>
                <div class="form-group">
                    <label for="passportIssueDate">Issue Date <span class="required">*</span></label>
                    <input type="date" id="passportIssueDate" required>
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="passportExpiryDate">Expiry Date <span class="required">*</span></label>
                    <input type="date" id="passportExpiryDate" required>
                </div>
                <div class="form-group">
                    <label for="placeOfIssue">Place of Issue <span class="required">*</span></label>
                    <input type="text" id="placeOfIssue" required>
                </div>
            </div>
            
            <div class="form-group">
                <label for="previousVisaHistory">Previous US Visa History</label>
                <select id="previousVisaHistory">
                    <option value="">Select Option</option>
                    <option value="never">Never applied</option>
                    <option value="approved">Previously approved</option>
                    <option value="denied">Previously denied</option>
                </select>
            </div>
            
            <button type="button" class="btn btn-secondary" onclick="previousStep()">Previous</button>
            <button type="button" class="btn" onclick="nextStep()">Next</button>
        </div>

        <!-- Step 5: Education and Financial Background -->
        <div id="step5" class="form-section hidden">
            <h2 class="section-title">Education and Financial Background</h2>
            <p class="section-subtitle">Please provide details about your educational qualifications and financial background.</p>
            
            <div class="form-group">
                <label for="education">Highest Education Level <span class="required">*</span></label>
                <select id="education" required>
                    <option value="">Select Education Level</option>
                    <option value="high_school">High School (12th Grade)</option>
                    <option value="diploma">Diploma</option>
                    <option value="bachelors">Bachelor's Degree</option>
                    <option value="masters">Master's Degree</option>
                    <option value="phd">PhD/Doctorate</option>
                    <option value="professional">Professional Degree</option>
                </select>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="fieldOfStudy">Field of Study <span class="required">*</span></label>
                    <input type="text" id="fieldOfStudy" required placeholder="e.g., Computer Science, Engineering">
                </div>
                <div class="form-group">
                    <label for="university">University/Institution <span class="required">*</span></label>
                    <input type="text" id="university" required placeholder="Name of your university">
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="graduationYear">Graduation Year <span class="required">*</span></label>
                    <input type="number" id="graduationYear" required min="1980" max="2030" placeholder="YYYY">
                </div>
                <div class="form-group">
                    <label for="gpa">GPA/Percentage <span class="required">*</span></label>
                    <input type="text" id="gpa" required placeholder="e.g., 8.5 CGPA or 85%">
                </div>
            </div>
            
            <div class="form-group">
                <label for="studySponsorship">Who sponsored your studies? <span class="required">*</span></label>
                <select id="studySponsorship" required>
                    <option value="">Select Sponsor</option>
                    <option value="self">Self-funded</option>
                    <option value="parents">Parents/Family</option>
                    <option value="scholarship">Government Scholarship</option>
                    <option value="private_scholarship">Private Scholarship</option>
                    <option value="education_loan">Education Loan</option>
                    <option value="employer">Employer Sponsored</option>
                    <option value="other">Other</option>
                </select>
            </div>
            
            <div class="form-group" id="sponsorDetailsField" style="display: none;">
                <label for="sponsorDetails">Sponsor Details</label>
                <textarea id="sponsorDetails" rows="3" placeholder="Please provide details about your sponsor"></textarea>
            </div>
            
            <div class="form-group">
                <label for="propertyOwnership">Do you own any property in India? <span class="required">*</span></label>
                <select id="propertyOwnership" required>
                    <option value="">Select Option</option>
                    <option value="yes">Yes</option>
                    <option value="no">No</option>
                </select>
            </div>
            
            <div class="form-group" id="propertyDetailsField" style="display: none;">
                <label for="propertyDetails">Property Details</label>
                <textarea id="propertyDetails" rows="3" placeholder="Describe your property (type, location, approximate value)"></textarea>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="familyIncome">Annual Family Income (INR) <span class="required">*</span></label>
                    <select id="familyIncome" required>
                        <option value="">Select Income Range</option>
                        <option value="below_5_lakh">Below ₹5 Lakh</option>
                        <option value="5_10_lakh">₹5-10 Lakh</option>
                        <option value="10_20_lakh">₹10-20 Lakh</option>
                        <option value="20_50_lakh">₹20-50 Lakh</option>
                        <option value="50_lakh_1_crore">₹50 Lakh - 1 Crore</option>
                        <option value="above_1_crore">Above ₹1 Crore</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="bankBalance">Current Bank Balance (INR) <span class="required">*</span></label>
                    <input type="number" id="bankBalance" required placeholder="Enter amount in INR">
                </div>
            </div>
            
            <div class="form-group">
                <label for="additionalQualifications">Additional Certifications/Qualifications</label>
                <textarea id="additionalQualifications" rows="3" placeholder="List any professional certifications, courses, or additional qualifications"></textarea>
            </div>
            
            <button type="button" class="btn btn-secondary" onclick="previousStep()">Previous</button>
            <button type="button" class="btn" onclick="nextStep()">Next</button>
        </div>

        <!-- Step 6: Employment Information -->
        <div id="step6" class="form-section hidden">
            <h2 class="section-title">Employment Information</h2>
            <p class="section-subtitle">Please provide comprehensive details about your current and previous employment history.</p>
            
            <div class="form-group">
                <label for="currentEmployer">Current Employer <span class="required">*</span></label>
                <input type="text" id="currentEmployer" required placeholder="Company name">
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="jobTitle">Current Job Title <span class="required">*</span></label>
                    <input type="text" id="jobTitle" required placeholder="Your current designation">
                </div>
                <div class="form-group">
                    <label for="employmentType">Employment Type <span class="required">*</span></label>
                    <select id="employmentType" required>
                        <option value="">Select Type</option>
                        <option value="full_time">Full-time</option>
                        <option value="part_time">Part-time</option>
                        <option value="contract">Contract</option>
                        <option value="consultant">Consultant</option>
                        <option value="freelancer">Freelancer</option>
                    </select>
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="workExperience">Total Work Experience (Years) <span class="required">*</span></label>
                    <input type="number" id="workExperience" required min="0" max="50" placeholder="Years of experience">
                </div>
                <div class="form-group">
                    <label for="currentJobDuration">Current Job Duration (Months) <span class="required">*</span></label>
                    <input type="number" id="currentJobDuration" required min="0" placeholder="Months in current role">
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="currentSalary">Current Annual Salary (INR) <span class="required">*</span></label>
                    <input type="number" id="currentSalary" required placeholder="Annual salary in INR">
                </div>
                <div class="form-group">
                    <label for="proposedSalary">Proposed US Salary (USD) <span class="required">*</span></label>
                    <input type="number" id="proposedSalary" required placeholder="Expected US salary">
                </div>
            </div>
            
            <div class="form-group">
                <label for="industryType">Industry Type <span class="required">*</span></label>
                <select id="industryType" required>
                    <option value="">Select Industry</option>
                    <option value="information_technology">Information Technology</option>
                    <option value="software_development">Software Development</option>
                    <option value="consulting">Consulting</option>
                    <option value="finance">Finance & Banking</option>
                    <option value="healthcare">Healthcare</option>
                    <option value="manufacturing">Manufacturing</option>
                    <option value="education">Education</option>
                    <option value="retail">Retail</option>
                    <option value="telecommunications">Telecommunications</option>
                    <option value="other">Other</option>
                </select>
            </div>
            
            <div class="form-group">
                <label for="responsibilities">Key Responsibilities <span class="required">*</span></label>
                <textarea id="responsibilities" rows="4" required placeholder="Describe your key responsibilities, achievements, and projects in detail..."></textarea>
            </div>
            
            <div class="form-group">
                <label for="skillsExpertise">Technical Skills & Expertise <span class="required">*</span></label>
                <textarea id="skillsExpertise" rows="3" required placeholder="List your technical skills, programming languages, tools, and areas of expertise..."></textarea>
            </div>
            
            <div class="form-group">
                <label for="previousEmployer">Previous Employer (if any)</label>
                <input type="text" id="previousEmployer" placeholder="Previous company name">
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="previousJobTitle">Previous Job Title</label>
                    <input type="text" id="previousJobTitle" placeholder="Previous designation">
                </div>
                <div class="form-group">
                    <label for="previousJobDuration">Previous Job Duration (Months)</label>
                    <input type="number" id="previousJobDuration" min="0" placeholder="Duration in months">
                </div>
            </div>
            
            <div class="form-group">
                <label for="reasonForChange">Reason for Job Change</label>
                <select id="reasonForChange">
                    <option value="">Select Reason</option>
                    <option value="career_growth">Career Growth</option>
                    <option value="better_opportunity">Better Opportunity</option>
                    <option value="higher_salary">Higher Salary</option>
                    <option value="relocation">Relocation</option>
                    <option value="company_closure">Company Closure</option>
                    <option value="contract_ended">Contract Ended</option>
                    <option value="other">Other</option>
                </select>
            </div>
            
            <button type="button" class="btn btn-secondary" onclick="previousStep()">Previous</button>
            <button type="button" class="btn" onclick="nextStep()">Next</button>
        </div>

        <!-- Step 7: US Employer Information -->
        <div id="step7" class="form-section hidden">
            <h2 class="section-title">US Employer Information</h2>
            
            <div class="form-group">
                <label for="usEmployer">US Employer Name <span class="required">*</span></label>
                <input type="text" id="usEmployer" required>
            </div>
            
            <div class="form-group">
                <label for="usEmployerAddress">US Employer Address <span class="required">*</span></label>
                <textarea id="usEmployerAddress" rows="3" required></textarea>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="usJobTitle">US Job Title <span class="required">*</span></label>
                    <input type="text" id="usJobTitle" required>
                </div>
                <div class="form-group">
                    <label for="startDate">Proposed Start Date <span class="required">*</span></label>
                    <input type="date" id="startDate" required>
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="contractDuration">Contract Duration (Years) <span class="required">*</span></label>
                    <select id="contractDuration" required>
                        <option value="">Select Duration</option>
                        <option value="1">1 Year</option>
                        <option value="2">2 Years</option>
                        <option value="3">3 Years</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="workLocation">Work Location <span class="required">*</span></label>
                    <input type="text" id="workLocation" required>
                </div>
            </div>
            
            <button type="button" class="btn btn-secondary" onclick="previousStep()">Previous</button>
            <button type="button" class="btn" onclick="nextStep()">Next</button>
        </div>

        <!-- Step 8: Document Checklist -->
        <div id="step8" class="form-section hidden">
            <h2 class="section-title">Required Documents</h2>
            <p style="margin-bottom: 20px; color: #666;">Please confirm that you have the following documents ready for submission:</p>
            
            <div class="document-checklist">
                <div class="document-item">
                    <input type="checkbox" id="doc1" required>
                    <label for="doc1">Valid Passport (with at least 6 months validity)</label>
                </div>
                <div class="document-item">
                    <input type="checkbox" id="doc2" required>
                    <label for="doc2">Recent Passport-size Photograph (2x2 inches, white background)</label>
                </div>
                <div class="document-item">
                    <input type="checkbox" id="doc3" required>
                    <label for="doc3">Bank Statements (Last 6 months)</label>
                </div>
                <div class="document-item">
                    <input type="checkbox" id="doc4" required>
                    <label for="doc4">Employment Letter from Current Employer</label>
                </div>
                <div class="document-item">
                    <input type="checkbox" id="doc5" required>
                    <label for="doc5">Educational Certificates and Transcripts</label>
                </div>
                <div class="document-item">
                    <input type="checkbox" id="doc6" required>
                    <label for="doc6">Form I-129 (Petition for Nonimmigrant Worker)</label>
                </div>
                <div class="document-item">
                    <input type="checkbox" id="doc7" required>
                    <label for="doc7">Labor Condition Application (LCA)</label>
                </div>
                <div class="document-item">
                    <input type="checkbox" id="doc8" required>
                    <label for="doc8">Resume/CV</label>
                </div>
            </div>
            
            <button type="button" class="btn btn-secondary" onclick="previousStep()">Previous</button>
            <button type="button" class="btn" onclick="nextStep()">Next</button>
        </div>

        <!-- Step 9: Review and Submit -->
        <div id="step9" class="form-section hidden">
            <h2 class="section-title">Review and Submit</h2>
            
            <div class="appointment-info">
                <h3>Embassy Appointment Information</h3>
                <p><strong>Embassy:</strong> US Consulate General, Mumbai</p>
                <p><strong>Scheduled Date:</strong> <span id="appointmentDate"></span></p>
                <p><strong>Address:</strong> C-49, G Block, Bandra Kurla Complex, Bandra East, Mumbai, Maharashtra 400051</p>
                <p style="margin-top: 10px; color: #666;"><em>Your appointment is automatically scheduled for 6 months from submission date.</em></p>
            </div>
            
            <div class="payment-info">
                <h3>Visa Application Fee</h3>
                <p><strong>Amount:</strong> USD $340</p>
                <p><strong>Payment Method:</strong> Online payment to US Department of State</p>
                <a href="https://cgifederal.secure.force.com/" target="_blank" class="btn" style="display: inline-block; margin-top: 10px; text-decoration: none;">
                    Pay Visa Fee (Official US Portal)
                </a>
                <p style="margin-top: 10px; color: #666; font-size: 12px;"><em>You will be redirected to the official US government payment portal.</em></p>
            </div>
            
            <div style="background: #f8f9fa; padding: 20px; border-radius: 4px; margin: 20px 0;">
                <h3>Application Summary</h3>
                <div id="applicationSummary"></div>
            </div>
            
            <div style="margin: 30px 0; padding: 20px; border: 2px solid #1e3c72; border-radius: 4px;">
                <input type="checkbox" id="finalConfirmation" required style="width: auto; margin-right: 10px;">
                <label for="finalConfirmation" style="display: inline;">
                    I hereby declare that all information provided is true and accurate to the best of my knowledge. I understand that providing false information may result in denial of my visa application and potential legal consequences.
                </label>
            </div>
            
            <button type="button" class="btn btn-secondary" onclick="previousStep()">Previous</button>
            <button type="button" class="btn" onclick="submitApplication()">Submit Application</button>
        </div>

        <!-- Application Tracking Display -->
        <div id="trackingDisplay" class="form-section hidden">
            <h2 class="section-title">Application Status Tracking</h2>
            <div id="trackingContent">
                <div class="acknowledgment-box">
                    <p><strong>Acknowledgment Number:</strong></p>
                    <div class="acknowledgment-number" id="trackingAckNumber"></div>
                    <div id="statusBadge" class="status-badge status-submitted" style="margin: 20px 0;"></div>
                </div>
                
                <div class="tracking-timeline" id="trackingTimeline">
                    <!-- Timeline will be populated dynamically -->
                </div>
                
                <div id="trackingDetails" class="tracking-details">
                    <!-- Application details will be populated here -->
                </div>
                
                <div style="text-align: center; margin-top: 30px;">
                    <button type="button" class="btn btn-secondary" onclick="backToHome()">Back to Home</button>
                    <button type="button" class="btn" onclick="refreshTracking()">Refresh Status</button>
                </div>
            </div>
        </div>

        <!-- Admin Login -->
        <div id="adminLogin" class="form-section hidden">
            <h2 class="section-title">Admin Login</h2>
            <div class="auth-section">
                <div class="form-group">
                    <label for="adminUsername">Username</label>
                    <input type="text" id="adminUsername" placeholder="Enter admin username">
                </div>
                <div class="form-group">
                    <label for="adminPassword">Password</label>
                    <input type="password" id="adminPassword" placeholder="Enter admin password">
                </div>
                <button type="button" class="btn" onclick="adminLogin()">Login</button>
                <button type="button" class="btn btn-secondary" onclick="backToHome()">Back</button>
            </div>
        </div>

        <!-- Admin Dashboard -->
        <div id="adminDashboard" class="form-section hidden">
            <h2 class="section-title">Admin Dashboard</h2>
            <div class="admin-controls">
                <div class="form-group">
                    <label for="adminSearchAck">Search by Acknowledgment Number</label>
                    <input type="text" id="adminSearchAck" placeholder="ACK-XXXXXXXX">
                    <button type="button" class="btn" onclick="adminSearchApplication()">Search</button>
                </div>
                
                <div id="adminApplicationDetails" class="hidden">
                    <h3>Application Details</h3>
                    <div id="adminAppInfo"></div>
                    
                    <div class="form-group" style="margin-top: 30px;">
                        <label for="statusUpdate">Update Status</label>
                        <select id="statusUpdate">
                            <option value="submitted">Submitted</option>
                            <option value="under_review">Under Review</option>
                            <option value="documents_requested">Documents Requested</option>
                            <option value="interview_scheduled">Interview Scheduled</option>
                            <option value="approved">Approved</option>
                            <option value="rejected">Rejected</option>
                            <option value="on_hold">On Hold</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="statusNotes">Status Notes</label>
                        <textarea id="statusNotes" rows="3" placeholder="Add notes about the status update..."></textarea>
                    </div>
                    
                    <button type="button" class="btn" onclick="updateApplicationStatus()">Update Status</button>
                </div>
                
                <div style="margin-top: 30px;">
                    <button type="button" class="btn" onclick="viewAllApplications()">View All Applications</button>
                    <button type="button" class="btn btn-secondary" onclick="adminLogout()">Logout</button>
                </div>
            </div>
        </div>

        <!-- All Applications View -->
        <div id="allApplicationsView" class="form-section hidden">
            <h2 class="section-title">All Applications</h2>
            <div id="applicationsTable">
                <!-- Applications table will be populated here -->
            </div>
            <button type="button" class="btn btn-secondary" onclick="backToAdminDashboard()">Back to Dashboard</button>
        </div>

        <!-- Final Confirmation -->
        <div id="finalConfirmationPage" class="form-section hidden">
            <div style="text-align: center; padding: 40px;">
                <h2 style="color: #4caf50; margin-bottom: 20px;">Application Submitted Successfully!</h2>
                <div class="acknowledgment-box">
                    <p><strong>Your Acknowledgment Number:</strong></p>
                    <div class="acknowledgment-number" id="finalAckNumber"></div>
                    <p>Application submitted on: <span id="submissionDate"></span></p>
                    <p>Embassy appointment: <span id="finalAppointmentDate"></span></p>
                </div>
                <p style="margin: 20px 0; color: #666;">
                    A confirmation email has been sent to your registered email address with all the details.
                    Please keep your acknowledgment number safe for future reference.
                </p>
                <button type="button" class="btn" onclick="viewApplicationDocument()">View Application Document</button>
                <button type="button" class="btn btn-success" onclick="downloadPDF()">Download PDF</button>
                <button type="button" class="btn btn-secondary" onclick="signOut()">Sign Out</button>
            </div>
        </div>

        <!-- PDF Document View -->
        <div id="pdfDocumentView" class="pdf-document hidden">
            <div class="pdf-header">
                <div class="seal">
                    USCIS<br>
                    OFFICIAL<br>
                    SEAL
                </div>
                <h1>H1B VISA APPLICATION</h1>
                <p><strong>Form I-129 - Petition for Nonimmigrant Worker</strong></p>
                <p>United States Citizenship and Immigration Services</p>
                <p>Department of Homeland Security</p>
            </div>

            <div class="pdf-content">
                <div style="text-align: center; margin-bottom: 30px;">
                    <span class="status-badge status-submitted">Application Submitted</span>
                    <p style="margin-top: 10px;"><strong>Acknowledgment Number:</strong> <span id="pdfAckNumber"></span></p>
                    <p><strong>Submission Date:</strong> <span id="pdfSubmissionDate"></span></p>
                </div>

                <div class="pdf-section">
                    <h3>Personal Information</h3>
                    <div id="pdfPersonalInfo"></div>
                </div>

                <div class="pdf-section">
                    <h3>Family Information</h3>
                    <div id="pdfFamilyInfo"></div>
                </div>

                <div class="pdf-section">
                    <h3>Contact Information</h3>
                    <div id="pdfContactInfo"></div>
                </div>

                <div class="pdf-section">
                    <h3>Passport Information</h3>
                    <div id="pdfPassportInfo"></div>
                </div>

                <div class="pdf-section">
                    <h3>Education Information</h3>
                    <div id="pdfEducationInfo"></div>
                </div>

                <div class="pdf-section">
                    <h3>Employment Information</h3>
                    <div id="pdfEmploymentInfo"></div>
                </div>

                <div class="pdf-section">
                    <h3>US Employer Information</h3>
                    <div id="pdfUSEmployerInfo"></div>
                </div>

                <div class="pdf-section">
                    <h3>Embassy Appointment</h3>
                    <div id="pdfAppointmentInfo"></div>
                </div>

                <div class="signature-section">
                    <div class="signature-box">
                        <div class="signature-line"></div>
                        <p><strong>Applicant Signature</strong></p>
                        <p>Date: <span id="pdfSignatureDate"></span></p>
                    </div>
                    <div class="signature-box">
                        <div class="signature-line"></div>
                        <p><strong>USCIS Officer</strong></p>
                        <p>Date: ___________</p>
                    </div>
                </div>
            </div>

            <div class="pdf-footer">
                <p><strong>IMPORTANT NOTICE:</strong> This is an official document generated by the USCIS H1B Application System.</p>
                <p>Please bring this document along with all required supporting documents to your embassy appointment.</p>
                <p>For questions or concerns, contact USCIS at 1-800-375-5283 or visit www.uscis.gov</p>
                <p style="margin-top: 20px;">Document ID: <span id="pdfDocumentId"></span> | Generated: <span id="pdfGeneratedDate"></span></p>
            </div>

            <div style="text-align: center; padding: 20px; background: #f8f9fa;">
                <button type="button" class="btn" onclick="printDocument()">Print Document</button>
                <button type="button" class="btn btn-success" onclick="downloadPDF()">Download PDF</button>
                <button type="button" class="btn btn-secondary" onclick="backToApplication()">Back to Application</button>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-auth-compat.js"></script>
    
    <!-- EmailJS -->
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDVmXF8KdScaXAVqmpgB5CaJMjFLr00hDw",
            authDomain: "h1bvisa-73e93.firebaseapp.com",
            projectId: "h1bvisa-73e93",
            storageBucket: "h1bvisa-73e93.firebasestorage.app",
            messagingSenderId: "697062091568",
            appId: "1:697062091568:web:70061eb70023788b8bf6f5"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();

        // EmailJS Configuration
        emailjs.init('QI1aOpAqKdm9d4BkT');

        // Application State
        let currentStep = 1;
        let applicationData = {};
        let acknowledgmentNumber = '';
        let currentUser = null;
        let isAdmin = false;
        let currentTrackingApp = null;

        // Session Management
        let inactivityTimer;

        function resetTimer() {
            clearTimeout(inactivityTimer);
            document.getElementById('sessionWarning').style.display = 'none';
            
            inactivityTimer = setTimeout(() => {
                saveProgress();
                alert('Session expired due to inactivity. Your progress has been saved.');
                signOut();
            }, 30000); // 30 seconds
        }

        // Initialize session management
        function initializeSession() {
            ['click', 'keypress', 'input', 'change', 'focus'].forEach(evt =>
                document.addEventListener(evt, resetTimer)
            );
            resetTimer();
        }

        // Authentication Functions
        function showSignUp() {
            document.getElementById('loginForm').classList.add('hidden');
            document.getElementById('signupForm').classList.remove('hidden');
        }

        function showSignIn() {
            document.getElementById('signupForm').classList.add('hidden');
            document.getElementById('loginForm').classList.remove('hidden');
        }

        async function signUp() {
            const email = document.getElementById('signupEmail').value.trim();
            const password = document.getElementById('signupPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;

            if (!email || !password || !confirmPassword) {
                showError('Please fill in all fields.');
                return;
            }

            if (password !== confirmPassword) {
                showError('Passwords do not match.');
                return;
            }

            if (password.length < 6) {
                showError('Password must be at least 6 characters long.');
                return;
            }

            try {
                const userCredential = await auth.createUserWithEmailAndPassword(email, password);
                currentUser = userCredential.user;
                showSuccess('Account created successfully!');
                initializeApplication();
            } catch (error) {
                console.error('Sign up error:', error);
                showError(error.message);
            }
        }

        async function signIn() {
            const email = document.getElementById('loginEmail').value.trim();
            const password = document.getElementById('loginPassword').value;

            if (!email || !password) {
                showError('Please enter both email and password.');
                return;
            }

            try {
                const userCredential = await auth.signInWithEmailAndPassword(email, password);
                currentUser = userCredential.user;
                showSuccess('Signed in successfully!');
                initializeApplication();
            } catch (error) {
                console.error('Sign in error:', error);
                showError('Invalid email or password.');
            }
        }

        async function signOut() {
            try {
                await auth.signOut();
                currentUser = null;
                acknowledgmentNumber = '';
                applicationData = {};
                
                // Reset UI
                document.getElementById('authSection').classList.remove('hidden');
                document.getElementById('progressSection').classList.add('hidden');
                hideAllSteps();
                
                showSuccess('Signed out successfully!');
            } catch (error) {
                console.error('Sign out error:', error);
                showError('Error signing out.');
            }
        }

        function initializeApplication() {
            document.getElementById('progressSection').classList.remove('hidden');
            
            showStep(1);
            updateProgress();
            initializeSession();
        }

        // Utility Functions
        function generateAckNumber() {
            const timestamp = Date.now().toString().slice(-6);
            const random = Math.random().toString(36).substr(2, 4).toUpperCase();
            return `ACK-${timestamp}${random}`;
        }

        function showError(message) {
            const errorDiv = document.getElementById('errorMessage');
            errorDiv.textContent = message;
            errorDiv.style.display = 'block';
            setTimeout(() => {
                errorDiv.style.display = 'none';
            }, 5000);
        }

        function showSuccess(message) {
            const successDiv = document.getElementById('successMessage');
            successDiv.textContent = message;
            successDiv.style.display = 'block';
            setTimeout(() => {
                successDiv.style.display = 'none';
            }, 5000);
        }

        function hideAllSteps() {
            for (let i = 1; i <= 8; i++) {
                document.getElementById(`step${i}`).classList.add('hidden');
            }
            document.getElementById('acknowledgmentDisplay').classList.add('hidden');
            document.getElementById('finalConfirmationPage').classList.add('hidden');
            document.getElementById('pdfDocumentView').classList.add('hidden');
            document.getElementById('trackingDisplay').classList.add('hidden');
            document.getElementById('adminLogin').classList.add('hidden');
            document.getElementById('adminDashboard').classList.add('hidden');
            document.getElementById('allApplicationsView').classList.add('hidden');
        }

        function showStep(step) {
            hideAllSteps();
            
            if (step === 'acknowledgment') {
                document.getElementById('acknowledgmentDisplay').classList.remove('hidden');
            } else if (step === 'final') {
                document.getElementById('finalConfirmationPage').classList.remove('hidden');
            } else if (step === 'pdf') {
                document.getElementById('pdfDocumentView').classList.remove('hidden');
            } else if (step === 'tracking') {
                document.getElementById('trackingDisplay').classList.remove('hidden');
            } else if (step === 'adminLogin') {
                document.getElementById('adminLogin').classList.remove('hidden');
            } else if (step === 'adminDashboard') {
                document.getElementById('adminDashboard').classList.remove('hidden');
            } else if (step === 'allApplications') {
                document.getElementById('allApplicationsView').classList.remove('hidden');
            } else {
                document.getElementById(`step${step}`).classList.remove('hidden');
            }
        }

        function updateProgress() {
            const progress = (currentStep / 9) * 100;
            document.getElementById('progressFill').style.width = `${progress}%`;
            document.getElementById('currentStep').textContent = currentStep;
        }

        // Step Navigation
        function nextStep() {
            if (validateCurrentStep()) {
                saveProgress();
                currentStep++;
                if (currentStep <= 9) {
                    showStep(currentStep);
                    updateProgress();
                }
            }
        }

        function previousStep() {
            if (currentStep > 2) {
                currentStep--;
                showStep(currentStep);
                updateProgress();
            }
        }

        function validateCurrentStep() {
            const currentStepDiv = document.getElementById(`step${currentStep}`);
            const requiredInputs = currentStepDiv.querySelectorAll('[required]');
            
            for (let input of requiredInputs) {
                if (!input.value.trim()) {
                    showError(`Please fill in all required fields.`);
                    input.focus();
                    return false;
                }
            }
            
            // Additional validation for specific steps
            if (currentStep === 4) {
                const expiryDate = new Date(document.getElementById('passportExpiryDate').value);
                const today = new Date();
                const sixMonthsFromNow = new Date();
                sixMonthsFromNow.setMonth(today.getMonth() + 6);
                
                if (expiryDate < sixMonthsFromNow) {
                    showError('Passport must be valid for at least 6 months from today.');
                    return false;
                }
            }
            
            if (currentStep === 8) {
                const checkboxes = document.querySelectorAll('#step8 input[type="checkbox"]');
                const allChecked = Array.from(checkboxes).every(cb => cb.checked);
                
                if (!allChecked) {
                    showError('Please confirm that you have all required documents.');
                    return false;
                }
            }
            
            return true;
        }

        // Data Management
        function collectFormData() {
            const data = {
                personal_info: {
                    name: (document.getElementById('firstName')?.value || '') + ' ' + (document.getElementById('lastName')?.value || ''),
                    dob: document.getElementById('dateOfBirth')?.value || '',
                    age: document.getElementById('dateOfBirth')?.value ? 
                        new Date().getFullYear() - new Date(document.getElementById('dateOfBirth').value).getFullYear() : 0,
                    email: document.getElementById('email')?.value || document.getElementById('initialEmail')?.value || '',
                    phone: document.getElementById('phone')?.value || '',
                    address: document.getElementById('currentAddress')?.value || ''
                },
                family_info: {
                    father_name: document.getElementById('fatherName')?.value || '',
                    mother_name: document.getElementById('motherName')?.value || '',
                    spouse_name: document.getElementById('spouseName')?.value || ''
                },
                education: {
                    highest_degree: document.getElementById('education')?.value || '',
                    university: document.getElementById('university')?.value || '',
                    graduation_year: document.getElementById('graduationYear')?.value ? 
                        parseInt(document.getElementById('graduationYear').value) : 0
                },
                work_experience: [{
                    company_name: document.getElementById('currentEmployer')?.value || '',
                    role: document.getElementById('jobTitle')?.value || '',
                    duration_months: document.getElementById('workExperience')?.value ? 
                        parseInt(document.getElementById('workExperience').value) * 12 : 0,
                    responsibilities: document.getElementById('responsibilities')?.value || ''
                }],
                document_selection: {
                    passport: document.getElementById('doc1')?.checked || false,
                    photo: document.getElementById('doc2')?.checked || false,
                    bank_statement: document.getElementById('doc3')?.checked || false
                },
                embassy_appointment: {
                    date: firebase.firestore.Timestamp.fromDate(new Date(Date.now() + 6 * 30 * 24 * 60 * 60 * 1000)),
                    payment_required: 340
                },
                application_status: 'submitted',
                acknowledgment_number: acknowledgmentNumber,
                created_at: firebase.firestore.Timestamp.now(),
                updated_at: firebase.firestore.Timestamp.now(),
                email: document.getElementById('email')?.value || document.getElementById('initialEmail')?.value || ''
            };
            
            return data;
        }

        function populateForm(data) {
            if (data.personal_info) {
                const nameParts = data.personal_info.name.split(' ');
                if (document.getElementById('firstName')) document.getElementById('firstName').value = nameParts[0] || '';
                if (document.getElementById('lastName')) document.getElementById('lastName').value = nameParts.slice(1).join(' ') || '';
                if (document.getElementById('dateOfBirth')) document.getElementById('dateOfBirth').value = data.personal_info.dob || '';
                if (document.getElementById('phone')) document.getElementById('phone').value = data.personal_info.phone || '';
                if (document.getElementById('currentAddress')) document.getElementById('currentAddress').value = data.personal_info.address || '';
            }
            
            if (data.family_info) {
                if (document.getElementById('fatherName')) document.getElementById('fatherName').value = data.family_info.father_name || '';
                if (document.getElementById('motherName')) document.getElementById('motherName').value = data.family_info.mother_name || '';
                if (document.getElementById('spouseName')) document.getElementById('spouseName').value = data.family_info.spouse_name || '';
            }
            
            if (data.education) {
                if (document.getElementById('education')) document.getElementById('education').value = data.education.highest_degree || '';
                if (document.getElementById('university')) document.getElementById('university').value = data.education.university || '';
                if (document.getElementById('graduationYear')) document.getElementById('graduationYear').value = data.education.graduation_year || '';
            }
            
            if (data.work_experience && data.work_experience[0]) {
                if (document.getElementById('currentEmployer')) document.getElementById('currentEmployer').value = data.work_experience[0].company_name || '';
                if (document.getElementById('jobTitle')) document.getElementById('jobTitle').value = data.work_experience[0].role || '';
                if (document.getElementById('workExperience')) document.getElementById('workExperience').value = Math.floor(data.work_experience[0].duration_months / 12) || '';
                if (document.getElementById('responsibilities')) document.getElementById('responsibilities').value = data.work_experience[0].responsibilities || '';
            }
        }

        function saveProgress() {
            if (!acknowledgmentNumber) return;
            
            try {
                const formData = collectFormData();
                formData.currentStep = currentStep;
                formData.updated_at = new Date().toISOString();
                
                const existingApps = JSON.parse(localStorage.getItem('h1b_applications') || '{}');
                const userEmail = formData.personal_info.email;
                
                if (userEmail && existingApps[userEmail]) {
                    existingApps[userEmail] = { ...existingApps[userEmail], ...formData };
                    localStorage.setItem('h1b_applications', JSON.stringify(existingApps));
                }
                
                console.log('Progress saved successfully');
            } catch (error) {
                console.error('Error saving progress:', error);
            }
        }

        // Acknowledgment Number Functions
        function generateAcknowledgment() {
            const name = document.getElementById('initialName').value.trim();
            const email = document.getElementById('initialEmail').value.trim();
            
            if (!name || !email) {
                showError('Please enter your full name and email address.');
                return;
            }
            
            try {
                // Check if user already has an acknowledgment number in localStorage
                const existingApps = JSON.parse(localStorage.getItem('h1b_applications') || '{}');
                
                if (existingApps[email]) {
                    acknowledgmentNumber = existingApps[email].acknowledgment_number;
                    showSuccess('Using existing acknowledgment number for this email.');
                } else {
                    // Generate new acknowledgment number
                    acknowledgmentNumber = generateAckNumber();
                    
                    // Save initial data to localStorage
                    existingApps[email] = {
                        acknowledgment_number: acknowledgmentNumber,
                        personal_info: {
                            name: name,
                            email: email
                        },
                        application_status: 'in_progress',
                        created_at: new Date().toISOString(),
                        updated_at: new Date().toISOString(),
                        email: email
                    };
                    
                    localStorage.setItem('h1b_applications', JSON.stringify(existingApps));
                }
                
                // Send email (simplified version)
                sendAcknowledmentEmail({
                    user_name: name,
                    email: email,
                    ack_number: acknowledgmentNumber,
                    submission_date: new Date().toLocaleDateString()
                });
                
                // Display acknowledgment number
                document.getElementById('ackNumber').textContent = acknowledgmentNumber;
                showStep('acknowledgment');
                
            } catch (error) {
                console.error('Error generating acknowledgment:', error);
                showError('Error generating acknowledgment number. Please try again.');
            }
        }

        function loadExistingApplication() {
            const ackNum = document.getElementById('existingAck').value.trim();
            
            if (!ackNum) {
                showError('Please enter your acknowledgment number.');
                return;
            }
            
            try {
                const existingApps = JSON.parse(localStorage.getItem('h1b_applications') || '{}');
                let foundApp = null;
                
                // Find application by acknowledgment number
                for (const email in existingApps) {
                    if (existingApps[email].acknowledgment_number === ackNum) {
                        foundApp = existingApps[email];
                        break;
                    }
                }
                
                if (foundApp) {
                    // Load the application data
                    const userEmail = document.getElementById('initialEmail').value.trim();
                    if (foundApp.email && userEmail && foundApp.email !== userEmail) {
                        showError('This acknowledgment number was created with a different email address.');
                        return;
                    }
                    
                    acknowledgmentNumber = ackNum;
                    
                    // Populate form with saved data
                    populateForm(foundApp);
                    
                    // Go to saved step or step 2 if no progress
                    currentStep = foundApp.currentStep || 2;
                    showStep(currentStep);
                    updateProgress();
                    
                    showSuccess('Application loaded successfully!');
                } else {
                    showError('Invalid acknowledgment number. Please check and try again.');
                }
            } catch (error) {
                console.error('Error loading application:', error);
                showError('Error loading application. Please try again.');
            }
        }

        async function retrieveAcknowledgment() {
            const name = document.getElementById('retrieveName').value.trim();
            const dob = document.getElementById('retrieveDOB').value;
            const email = document.getElementById('retrieveEmail').value.trim();
            
            if (!name || !dob || !email) {
                showError('Please fill in all fields to retrieve your acknowledgment number.');
                return;
            }
            
            try {
                const snapshot = await db.collection('applications')
                    .where('personal_info.name', '==', name)
                    .where('personal_info.dob', '==', dob)
                    .where('email', '==', email)
                    .get();
                
                if (!snapshot.empty) {
                    const ack = snapshot.docs[0].data().acknowledgment_number;
                    alert(`Your acknowledgment number is: ${ack}`);
                    
                    await sendAcknowledmentEmail({
                        user_name: name,
                        email: email,
                        ack_number: ack,
                        submission_date: new Date().toLocaleDateString()
                    });
                    
                    // Display on screen
                    acknowledgmentNumber = ack;
                    document.getElementById('ackNumber').textContent = ack;
                    showStep('acknowledgment');
                } else {
                    alert('No application found with the provided details.');
                }
            } catch (error) {
                console.error('Error retrieving acknowledgment:', error);
                showError('Error retrieving acknowledgment number. Please try again.');
            }
        }

        async function sendAcknowledmentEmail(data) {
            try {
                const templateParams = {
                    user_name: data.user_name,
                    ack_number: data.ack_number,
                    email: data.email
                };
                
                const response = await emailjs.send('service_z3x1v6e', 'template_t16ktja', templateParams);
                console.log('Email sent successfully:', response);
                showSuccess('Acknowledgment email sent successfully!');
                return response;
            } catch (error) {
                console.error('Error sending acknowledgment email:', error);
                showError('Email could not be sent, but your acknowledgment number is: ' + data.ack_number);
                // Still show the acknowledgment number even if email fails
                alert(`Your acknowledgment number is: ${data.ack_number}\n\nPlease save this number for future reference.\n\nNote: Email delivery failed, but your application is saved.`);
                return Promise.resolve();
            }
        }

        function startApplication() {
            currentStep = 2;
            showStep(currentStep);
            updateProgress();
            
            // Pre-populate name and email from initial registration
            const initialName = document.getElementById('initialName').value;
            const initialEmail = document.getElementById('initialEmail').value;
            const nameParts = initialName.split(' ');
            document.getElementById('firstName').value = nameParts[0] || '';
            document.getElementById('lastName').value = nameParts.slice(1).join(' ') || '';
            document.getElementById('email').value = initialEmail;
        }

        // Application Submission
        async function submitApplication() {
            if (!document.getElementById('finalConfirmation').checked) {
                showError('Please confirm the declaration before submitting.');
                return;
            }
            
            try {
                const formData = collectFormData();
                formData.application_status = 'submitted';
                
                // Calculate appointment date (6 months from now)
                const appointmentDate = new Date();
                appointmentDate.setMonth(appointmentDate.getMonth() + 6);
                formData.embassy_appointment.date = firebase.firestore.Timestamp.fromDate(appointmentDate);
                
                // Save final application
                await db.collection('applications').doc(acknowledgmentNumber).set(formData, { merge: true });
                
                // Send confirmation email
                await sendConfirmationEmail(formData);
                
                // Show final confirmation
                document.getElementById('finalAckNumber').textContent = acknowledgmentNumber;
                document.getElementById('submissionDate').textContent = new Date().toLocaleDateString();
                document.getElementById('finalAppointmentDate').textContent = appointmentDate.toLocaleDateString();
                
                showStep('final');
                showSuccess('Application submitted successfully!');
                
            } catch (error) {
                console.error('Error submitting application:', error);
                showError('Error submitting application. Please try again.');
            }
        }

        async function sendConfirmationEmail(data) {
            try {
                const templateParams = {
                    user_name: data.personal_info.name,
                    email: data.personal_info.email,
                    ack_number: acknowledgmentNumber
                };
                
                const response = await emailjs.send('service_z3x1v6e', 'template_t16ktja', templateParams);
                console.log('Confirmation email sent successfully:', response);
                showSuccess('Confirmation email sent to your registered email address!');
            } catch (error) {
                console.error('Error sending confirmation email:', error);
                showError('Application submitted successfully, but confirmation email could not be sent.');
            }
        }

        // PDF Document Functions
        async function viewApplicationDocument() {
            try {
                const doc = await db.collection('applications').doc(acknowledgmentNumber).get();
                if (doc.exists) {
                    const data = doc.data();
                    generatePDFContent(data);
                    showStep('pdf');
                }
            } catch (error) {
                console.error('Error loading application data:', error);
                showError('Error loading application data.');
            }
        }

        function generatePDFContent(data) {
            // Set basic info
            document.getElementById('pdfAckNumber').textContent = acknowledgmentNumber;
            document.getElementById('pdfSubmissionDate').textContent = new Date().toLocaleDateString();
            document.getElementById('pdfSignatureDate').textContent = new Date().toLocaleDateString();
            document.getElementById('pdfDocumentId').textContent = `DOC-${acknowledgmentNumber}`;
            document.getElementById('pdfGeneratedDate').textContent = new Date().toLocaleString();

            // Personal Information
            const personalInfo = document.getElementById('pdfPersonalInfo');
            personalInfo.innerHTML = `
                <div class="pdf-field"><span class="label">Full Name:</span><span class="value">${data.personal_info?.name || 'N/A'}</span></div>
                <div class="pdf-field"><span class="label">Date of Birth:</span><span class="value">${data.personal_info?.dob || 'N/A'}</span></div>
                <div class="pdf-field"><span class="label">Age:</span><span class="value">${data.personal_info?.age || 'N/A'}</span></div>
                <div class="pdf-field"><span class="label">Gender:</span><span class="value">${document.getElementById('gender')?.value || 'N/A'}</span></div>
                <div class="pdf-field"><span class="label">Nationality:</span><span class="value">${document.getElementById('nationality')?.value || 'N/A'}</span></div>
                <div class="pdf-field"><span class="label">Marital Status:</span><span class="value">${document.getElementById('maritalStatus')?.value || 'N/A'}</span></div>
            `;

            // Family Information
            const familyInfo = document.getElementById('pdfFamilyInfo');
            familyInfo.innerHTML = `
                <div class="pdf-field"><span class="label">Father's Name:</span><span class="value">${data.family_info?.father_name || 'N/A'}</span></div>
                <div class="pdf-field"><span class="label">Mother's Name:</span><span class="value">${data.family_info?.mother_name || 'N/A'}</span></div>
                <div class="pdf-field"><span class="label">Spouse's Name:</span><span class="value">${data.family_info?.spouse_name || 'N/A'}</span></div>
            `;

            // Contact Information
            const contactInfo = document.getElementById('pdfContactInfo');
            contactInfo.innerHTML = `
                <div class="pdf-field"><span class="label">Email Address:</span><span class="value">${data.personal_info?.email || 'N/A'}</span></div>
                <div class="pdf-field"><span class="label">Phone Number:</span><span class="value">${data.personal_info?.phone || 'N/A'}</span></div>
                <div class="pdf-field"><span class="label">Address:</span><span class="value">${data.personal_info?.address || 'N/A'}</span></div>
                <div class="pdf-field"><span class="label">City:</span><span class="value">${document.getElementById('city')?.value || 'N/A'}</span></div>
                <div class="pdf-field"><span class="label">State:</span><span class="value">${document.getElementById('state')?.value || 'N/A'}</span></div>
                <div class="pdf-field"><span class="label">PIN Code:</span><span class="value">${document.getElementById('pincode')?.value || 'N/A'}</span></div>
            `;

            // Passport Information
            const passportInfo = document.getElementById('pdfPassportInfo');
            passportInfo.innerHTML = `
                <div class="pdf-field"><span class="label">Passport Number:</span><span class="value">${document.getElementById('passportNumber')?.value || 'N/A'}</span></div>
                <div class="pdf-field"><span class="label">Issue Date:</span><span class="value">${document.getElementById('passportIssueDate')?.value || 'N/A'}</span></div>
                <div class="pdf-field"><span class="label">Expiry Date:</span><span class="value">${document.getElementById('passportExpiryDate')?.value || 'N/A'}</span></div>
                <div class="pdf-field"><span class="label">Place of Issue:</span><span class="value">${document.getElementById('placeOfIssue')?.value || 'N/A'}</span></div>
                <div class="pdf-field"><span class="label">Previous US Visa:</span><span class="value">${document.getElementById('previousVisaHistory')?.value || 'N/A'}</span></div>
            `;

            // Education Information
            const educationInfo = document.getElementById('pdfEducationInfo');
            educationInfo.innerHTML = `
                <div class="pdf-field"><span class="label">Highest Degree:</span><span class="value">${data.education?.highest_degree || 'N/A'}</span></div>
                <div class="pdf-field"><span class="label">Field of Study:</span><span class="value">${document.getElementById('fieldOfStudy')?.value || 'N/A'}</span></div>
                <div class="pdf-field"><span class="label">University:</span><span class="value">${data.education?.university || 'N/A'}</span></div>
                <div class="pdf-field"><span class="label">Graduation Year:</span><span class="value">${data.education?.graduation_year || 'N/A'}</span></div>
            `;

            // Employment Information
            const employmentInfo = document.getElementById('pdfEmploymentInfo');
            const workExp = data.work_experience?.[0] || {};
            employmentInfo.innerHTML = `
                <div class="pdf-field"><span class="label">Current Employer:</span><span class="value">${workExp.company_name || 'N/A'}</span></div>
                <div class="pdf-field"><span class="label">Job Title:</span><span class="value">${workExp.role || 'N/A'}</span></div>
                <div class="pdf-field"><span class="label">Work Experience:</span><span class="value">${Math.floor(workExp.duration_months / 12) || 0} years</span></div>
                <div class="pdf-field"><span class="label">Current Salary:</span><span class="value">₹${document.getElementById('currentSalary')?.value || 'N/A'}</span></div>
                <div class="pdf-field"><span class="label">Proposed US Salary:</span><span class="value">$${document.getElementById('proposedSalary')?.value || 'N/A'}</span></div>
                <div class="pdf-field"><span class="label">Responsibilities:</span><span class="value">${workExp.responsibilities || 'N/A'}</span></div>
            `;

            // US Employer Information
            const usEmployerInfo = document.getElementById('pdfUSEmployerInfo');
            usEmployerInfo.innerHTML = `
                <div class="pdf-field"><span class="label">US Employer:</span><span class="value">${document.getElementById('usEmployer')?.value || 'N/A'}</span></div>
                <div class="pdf-field"><span class="label">US Job Title:</span><span class="value">${document.getElementById('usJobTitle')?.value || 'N/A'}</span></div>
                <div class="pdf-field"><span class="label">Work Location:</span><span class="value">${document.getElementById('workLocation')?.value || 'N/A'}</span></div>
                <div class="pdf-field"><span class="label">Start Date:</span><span class="value">${document.getElementById('startDate')?.value || 'N/A'}</span></div>
                <div class="pdf-field"><span class="label">Contract Duration:</span><span class="value">${document.getElementById('contractDuration')?.value || 'N/A'} years</span></div>
                <div class="pdf-field"><span class="label">Employer Address:</span><span class="value">${document.getElementById('usEmployerAddress')?.value || 'N/A'}</span></div>
            `;

            // Appointment Information
            const appointmentInfo = document.getElementById('pdfAppointmentInfo');
            const appointmentDate = data.embassy_appointment?.date?.toDate?.() || new Date(Date.now() + 6 * 30 * 24 * 60 * 60 * 1000);
            appointmentInfo.innerHTML = `
                <div class="pdf-field"><span class="label">Embassy:</span><span class="value">US Consulate General, Mumbai</span></div>
                <div class="pdf-field"><span class="label">Appointment Date:</span><span class="value">${appointmentDate.toLocaleDateString()}</span></div>
                <div class="pdf-field"><span class="label">Visa Fee:</span><span class="value">USD $340</span></div>
                <div class="pdf-field"><span class="label">Status:</span><span class="value">${data.application_status || 'Submitted'}</span></div>
            `;
        }

        function printDocument() {
            window.print();
        }

        function downloadPDF() {
            // Create a simple text-based download since we can't use external PDF libraries
            const data = collectFormData();
            const content = `
H1B VISA APPLICATION
Acknowledgment Number: ${acknowledgmentNumber}
Submission Date: ${new Date().toLocaleDateString()}

PERSONAL INFORMATION
Name: ${data.personal_info.name}
Date of Birth: ${data.personal_info.dob}
Email: ${data.personal_info.email}
Phone: ${data.personal_info.phone}
Address: ${data.personal_info.address}

FAMILY INFORMATION
Father's Name: ${data.family_info.father_name}
Mother's Name: ${data.family_info.mother_name}
Spouse's Name: ${data.family_info.spouse_name}

EDUCATION
Highest Degree: ${data.education.highest_degree}
University: ${data.education.university}
Graduation Year: ${data.education.graduation_year}

EMPLOYMENT
Current Employer: ${data.work_experience[0]?.company_name}
Job Title: ${data.work_experience[0]?.role}
Experience: ${Math.floor(data.work_experience[0]?.duration_months / 12)} years

EMBASSY APPOINTMENT
Date: ${new Date(Date.now() + 6 * 30 * 24 * 60 * 60 * 1000).toLocaleDateString()}
Fee: USD $340
Status: ${data.application_status}

This is an official document generated by the USCIS H1B Application System.
            `;
            
            const blob = new Blob([content], { type: 'text/plain' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `H1B_Application_${acknowledgmentNumber}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
        }

        function backToApplication() {
            showStep('final');
        }

        // Application Tracking Functions
        async function trackApplication() {
            const ackNum = document.getElementById('trackingAck').value.trim();
            
            if (!ackNum) {
                showError('Please enter your acknowledgment number.');
                return;
            }
            
            try {
                // First check localStorage
                const existingApps = JSON.parse(localStorage.getItem('h1b_applications') || '{}');
                let foundApp = null;
                
                for (const email in existingApps) {
                    if (existingApps[email].acknowledgment_number === ackNum) {
                        foundApp = existingApps[email];
                        break;
                    }
                }
                
                if (foundApp) {
                    currentTrackingApp = foundApp;
                    displayTrackingInfo(foundApp);
                    showStep('tracking');
                } else {
                    // Try Firebase if not found locally
                    const doc = await db.collection('applications').doc(ackNum).get();
                    if (doc.exists) {
                        currentTrackingApp = doc.data();
                        displayTrackingInfo(doc.data());
                        showStep('tracking');
                    } else {
                        showError('Application not found. Please check your acknowledgment number.');
                    }
                }
            } catch (error) {
                console.error('Error tracking application:', error);
                showError('Error retrieving application status. Please try again.');
            }
        }

        function displayTrackingInfo(appData) {
            document.getElementById('trackingAckNumber').textContent = appData.acknowledgment_number;
            
            // Update status badge
            const statusBadge = document.getElementById('statusBadge');
            const status = appData.application_status || 'submitted';
            statusBadge.textContent = formatStatusText(status);
            statusBadge.className = `status-badge status-${status}`;
            
            // Generate timeline
            generateTimeline(appData);
            
            // Display application details
            displayTrackingDetails(appData);
        }

        function formatStatusText(status) {
            const statusMap = {
                'submitted': 'Submitted',
                'under_review': 'Under Review',
                'documents_requested': 'Documents Requested',
                'interview_scheduled': 'Interview Scheduled',
                'approved': 'Approved',
                'rejected': 'Rejected',
                'on_hold': 'On Hold'
            };
            return statusMap[status] || 'Unknown';
        }

        function generateTimeline(appData) {
            const timeline = document.getElementById('trackingTimeline');
            const currentStatus = appData.application_status || 'submitted';
            
            const timelineSteps = [
                { id: 'submitted', title: 'Application Submitted', description: 'Your application has been received and is being processed.' },
                { id: 'under_review', title: 'Under Review', description: 'Your application is being reviewed by our team.' },
                { id: 'documents_requested', title: 'Documents Requested', description: 'Additional documents may be required.' },
                { id: 'interview_scheduled', title: 'Interview Scheduled', description: 'Your embassy interview has been scheduled.' },
                { id: 'approved', title: 'Approved', description: 'Congratulations! Your visa has been approved.' }
            ];
            
            let timelineHTML = '<h3 style="margin-bottom: 20px;">Application Timeline</h3>';
            
            timelineSteps.forEach((step, index) => {
                let itemClass = 'timeline-item';
                let date = '';
                
                if (step.id === currentStatus) {
                    itemClass += ' current';
                    date = new Date().toLocaleDateString();
                } else if (timelineSteps.findIndex(s => s.id === currentStatus) > index) {
                    itemClass += ' completed';
                    date = new Date(Date.now() - (timelineSteps.length - index) * 24 * 60 * 60 * 1000).toLocaleDateString();
                } else {
                    itemClass += ' pending';
                    date = 'Pending';
                }
                
                timelineHTML += `
                    <div class="${itemClass}">
                        <div class="timeline-content">
                            <div class="timeline-title">${step.title}</div>
                            <div class="timeline-date">${date}</div>
                            <div class="timeline-description">${step.description}</div>
                        </div>
                    </div>
                `;
            });
            
            timeline.innerHTML = timelineHTML;
        }

        function displayTrackingDetails(appData) {
            const detailsDiv = document.getElementById('trackingDetails');
            
            const appointmentDate = appData.embassy_appointment?.date?.toDate?.() || 
                                  new Date(Date.now() + 6 * 30 * 24 * 60 * 60 * 1000);
            
            detailsDiv.innerHTML = `
                <h3 style="margin-bottom: 20px;">Application Details</h3>
                <div class="detail-row">
                    <span class="detail-label">Applicant Name:</span>
                    <span class="detail-value">${appData.personal_info?.name || 'N/A'}</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Email:</span>
                    <span class="detail-value">${appData.personal_info?.email || appData.email || 'N/A'}</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Application Date:</span>
                    <span class="detail-value">${appData.created_at ? new Date(appData.created_at).toLocaleDateString() : 'N/A'}</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Current Status:</span>
                    <span class="detail-value">${formatStatusText(appData.application_status || 'submitted')}</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Embassy Appointment:</span>
                    <span class="detail-value">${appointmentDate.toLocaleDateString()}</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Visa Fee:</span>
                    <span class="detail-value">USD $340</span>
                </div>
                ${appData.status_notes ? `
                <div class="detail-row">
                    <span class="detail-label">Notes:</span>
                    <span class="detail-value">${appData.status_notes}</span>
                </div>
                ` : ''}
            `;
        }

        function refreshTracking() {
            if (currentTrackingApp) {
                trackApplication();
            }
        }

        function backToHome() {
            currentStep = 1;
            showStep(1);
            updateProgress();
            
            // Clear tracking data
            currentTrackingApp = null;
            document.getElementById('trackingAck').value = '';
        }

        // Admin Functions
        function showAdminLogin() {
            showStep('adminLogin');
        }

        function adminLogin() {
            const username = document.getElementById('adminUsername').value.trim();
            const password = document.getElementById('adminPassword').value;
            
            // Simple admin credentials (in production, use proper authentication)
            if (username === 'admin' && password === 'admin123') {
                isAdmin = true;
                showStep('adminDashboard');
                showSuccess('Admin login successful!');
            } else {
                showError('Invalid admin credentials.');
            }
        }

        function adminLogout() {
            isAdmin = false;
            document.getElementById('adminUsername').value = '';
            document.getElementById('adminPassword').value = '';
            backToHome();
            showSuccess('Admin logged out successfully.');
        }

        async function adminSearchApplication() {
            if (!isAdmin) {
                showError('Access denied. Please login as admin.');
                return;
            }
            
            const ackNum = document.getElementById('adminSearchAck').value.trim();
            
            if (!ackNum) {
                showError('Please enter an acknowledgment number.');
                return;
            }
            
            try {
                // Search in localStorage first
                const existingApps = JSON.parse(localStorage.getItem('h1b_applications') || '{}');
                let foundApp = null;
                
                for (const email in existingApps) {
                    if (existingApps[email].acknowledgment_number === ackNum) {
                        foundApp = existingApps[email];
                        break;
                    }
                }
                
                if (foundApp) {
                    displayAdminApplicationDetails(foundApp);
                } else {
                    // Try Firebase
                    const doc = await db.collection('applications').doc(ackNum).get();
                    if (doc.exists) {
                        displayAdminApplicationDetails(doc.data());
                    } else {
                        showError('Application not found.');
                        document.getElementById('adminApplicationDetails').classList.add('hidden');
                    }
                }
            } catch (error) {
                console.error('Error searching application:', error);
                showError('Error searching application.');
            }
        }

        function displayAdminApplicationDetails(appData) {
            const detailsDiv = document.getElementById('adminAppInfo');
            const appointmentDate = appData.embassy_appointment?.date?.toDate?.() || 
                                  new Date(Date.now() + 6 * 30 * 24 * 60 * 60 * 1000);
            
            detailsDiv.innerHTML = `
                <div class="detail-row">
                    <span class="detail-label">Acknowledgment Number:</span>
                    <span class="detail-value">${appData.acknowledgment_number}</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Applicant Name:</span>
                    <span class="detail-value">${appData.personal_info?.name || 'N/A'}</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Email:</span>
                    <span class="detail-value">${appData.personal_info?.email || appData.email || 'N/A'}</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Phone:</span>
                    <span class="detail-value">${appData.personal_info?.phone || 'N/A'}</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Current Status:</span>
                    <span class="detail-value">${formatStatusText(appData.application_status || 'submitted')}</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Application Date:</span>
                    <span class="detail-value">${appData.created_at ? new Date(appData.created_at).toLocaleDateString() : 'N/A'}</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Embassy Appointment:</span>
                    <span class="detail-value">${appointmentDate.toLocaleDateString()}</span>
                </div>
            `;
            
            // Set current status in dropdown
            document.getElementById('statusUpdate').value = appData.application_status || 'submitted';
            document.getElementById('statusNotes').value = appData.status_notes || '';
            
            document.getElementById('adminApplicationDetails').classList.remove('hidden');
        }

        async function updateApplicationStatus() {
            if (!isAdmin) {
                showError('Access denied.');
                return;
            }
            
            const ackNum = document.getElementById('adminSearchAck').value.trim();
            const newStatus = document.getElementById('statusUpdate').value;
            const notes = document.getElementById('statusNotes').value.trim();
            
            if (!ackNum || !newStatus) {
                showError('Please select an application and status.');
                return;
            }
            
            try {
                // Update in localStorage
                const existingApps = JSON.parse(localStorage.getItem('h1b_applications') || '{}');
                let updated = false;
                
                for (const email in existingApps) {
                    if (existingApps[email].acknowledgment_number === ackNum) {
                        existingApps[email].application_status = newStatus;
                        existingApps[email].status_notes = notes;
                        existingApps[email].updated_at = new Date().toISOString();
                        updated = true;
                        break;
                    }
                }
                
                if (updated) {
                    localStorage.setItem('h1b_applications', JSON.stringify(existingApps));
                }
                
                // Also update in Firebase if exists
                try {
                    await db.collection('applications').doc(ackNum).update({
                        application_status: newStatus,
                        status_notes: notes,
                        updated_at: firebase.firestore.Timestamp.now()
                    });
                } catch (firebaseError) {
                    console.log('Firebase update failed, but localStorage updated');
                }
                
                showSuccess('Application status updated successfully!');
                
                // Refresh the display
                adminSearchApplication();
                
            } catch (error) {
                console.error('Error updating status:', error);
                showError('Error updating application status.');
            }
        }

        async function viewAllApplications() {
            if (!isAdmin) {
                showError('Access denied.');
                return;
            }
            
            try {
                const existingApps = JSON.parse(localStorage.getItem('h1b_applications') || '{}');
                const applications = Object.values(existingApps);
                
                let tableHTML = `
                    <table class="applications-table">
                        <thead>
                            <tr>
                                <th>Acknowledgment Number</th>
                                <th>Name</th>
                                <th>Email</th>
                                <th>Status</th>
                                <th>Application Date</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                `;
                
                applications.forEach(app => {
                    const appDate = app.created_at ? new Date(app.created_at).toLocaleDateString() : 'N/A';
                    tableHTML += `
                        <tr>
                            <td>${app.acknowledgment_number}</td>
                            <td>${app.personal_info?.name || 'N/A'}</td>
                            <td>${app.personal_info?.email || app.email || 'N/A'}</td>
                            <td><span class="status-badge status-${app.application_status || 'submitted'}">${formatStatusText(app.application_status || 'submitted')}</span></td>
                            <td>${appDate}</td>
                            <td>
                                <button class="btn" style="padding: 5px 10px; font-size: 12px;" onclick="quickEditStatus('${app.acknowledgment_number}')">Edit</button>
                            </td>
                        </tr>
                    `;
                });
                
                tableHTML += '</tbody></table>';
                
                if (applications.length === 0) {
                    tableHTML = '<p style="text-align: center; color: #666; margin: 40px 0;">No applications found.</p>';
                }
                
                document.getElementById('applicationsTable').innerHTML = tableHTML;
                showStep('allApplications');
                
            } catch (error) {
                console.error('Error loading applications:', error);
                showError('Error loading applications.');
            }
        }

        function quickEditStatus(ackNum) {
            document.getElementById('adminSearchAck').value = ackNum;
            showStep('adminDashboard');
            adminSearchApplication();
        }

        function backToAdminDashboard() {
            showStep('adminDashboard');
        }

        // Initialize Application Summary
        function updateApplicationSummary() {
            const summaryDiv = document.getElementById('applicationSummary');
            
            const appointmentDate = new Date();
            appointmentDate.setMonth(appointmentDate.getMonth() + 6);
            document.getElementById('appointmentDate').textContent = appointmentDate.toLocaleDateString();
            
            summaryDiv.innerHTML = `
                <p><strong>Name:</strong> ${document.getElementById('firstName')?.value} ${document.getElementById('lastName')?.value}</p>
                <p><strong>Email:</strong> ${document.getElementById('email')?.value}</p>
                <p><strong>Phone:</strong> ${document.getElementById('phone')?.value}</p>
                <p><strong>Passport Number:</strong> ${document.getElementById('passportNumber')?.value}</p>
                <p><strong>Current Employer:</strong> ${document.getElementById('currentEmployer')?.value}</p>
                <p><strong>US Employer:</strong> ${document.getElementById('usEmployer')?.value}</p>
                <p><strong>Proposed Start Date:</strong> ${document.getElementById('startDate')?.value}</p>
                <p><strong>Acknowledgment Number:</strong> ${acknowledgmentNumber}</p>
            `;
        }

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            // Start application directly without authentication
            initializeApplication();
            
            // Add marital status toggle
            document.getElementById('maritalStatus').addEventListener('change', function() {
                const spouseField = document.getElementById('spouseField');
                if (this.value === 'married') {
                    spouseField.style.display = 'block';
                    document.getElementById('spouseName').required = true;
                } else {
                    spouseField.style.display = 'none';
                    document.getElementById('spouseName').required = false;
                    document.getElementById('spouseName').value = '';
                }
            });
            
            // Add event listener to update summary when reaching step 8
            const observer = new MutationObserver(function(mutations) {
                mutations.forEach(function(mutation) {
                    if (mutation.target.id === 'step8' && !mutation.target.classList.contains('hidden')) {
                        updateApplicationSummary();
                    }
                });
            });
            
            observer.observe(document.getElementById('step8'), {
                attributes: true,
                attributeFilter: ['class']
            });
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'96d6636ff6134936',t:'MTc1NDkwMTIxMC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
